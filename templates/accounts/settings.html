{% extends 'accounts/profile_base.html' %}
{% load static %}

{% block title %}Sozlamalar | TestMakon{% endblock %}

{% block profile_content %}

<!-- Parol -->
<div class="profile-card mb-3">
    <div class="profile-card-header">
        <h5><i class="bi bi-shield-lock-fill text-primary"></i> Xavfsizlik va Kirish</h5>
    </div>
    <div class="profile-card-body">
        <h6 class="fw-bold mb-3" style="color:var(--dark); font-size:0.9rem;"><i class="bi bi-key me-2 text-primary"></i>Parolni o'zgartirish</h6>
        <form action="{% url 'accounts:change_password' %}" method="post">
            {% csrf_token %}
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Joriy parol</label>
                    <input type="password" name="current_password" class="form-control" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Yangi parol</label>
                    <input type="password" name="new_password" class="form-control" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Tasdiqlang</label>
                    <input type="password" name="confirm_password" class="form-control" required>
                </div>
            </div>
            <div class="text-end mt-3">
                <button type="submit" class="btn btn-primary">Saqlash</button>
            </div>
        </form>
    </div>
</div>

<!-- Kontakt -->
<div class="profile-card mb-3">
    <div class="profile-card-header">
        <h5><i class="bi bi-phone-fill text-success"></i> Kontakt Ma'lumotlari</h5>
    </div>
    <div class="profile-card-body p-0">
        <div class="d-flex align-items-center justify-content-between p-4" style="border-bottom:1px solid var(--gray-200);">
            <div>
                <div style="font-size:0.7rem; font-weight:700; text-transform:uppercase; color:var(--gray-400); margin-bottom:4px;">Telefon raqam</div>
                <div style="font-size:1.1rem; font-weight:800; color:var(--dark);">{{ user.phone_number }}</div>
                {% if user.is_phone_verified %}
                <span class="badge mt-1" style="background:rgba(16,185,129,0.1); color:#059669; font-size:0.72rem;"><i class="bi bi-check-circle-fill me-1"></i>Tasdiqlangan</span>
                {% else %}
                <a href="{% url 'accounts:verify_phone' %}" class="badge mt-1 text-decoration-none" style="background:rgba(245,158,11,0.1); color:#D97706; font-size:0.72rem;">Tasdiqlash kerak</a>
                {% endif %}
            </div>
        </div>
        <div class="d-flex align-items-center justify-content-between p-4">
            <div>
                <div style="font-size:0.7rem; font-weight:700; text-transform:uppercase; color:var(--gray-400); margin-bottom:4px;">Email</div>
                {% if user.email %}
                <div style="font-size:1rem; font-weight:700; color:var(--dark);">{{ user.email }}</div>
                {% else %}
                <div style="color:var(--gray-400); font-style:italic; font-size:0.9rem;">Kiritilmagan</div>
                {% endif %}
            </div>
            <a href="{% url 'accounts:profile_edit' %}" class="btn btn-sm btn-light">O'zgartirish</a>
        </div>
    </div>
</div>

<!-- Telegram -->
<div class="profile-card mb-3">
    <div class="profile-card-body">
        <div class="d-flex align-items-center justify-content-between gap-3 p-3 rounded-3" style="background:rgba(0,136,204,0.06); border:1px solid rgba(0,136,204,0.15);">
            <div class="d-flex align-items-center gap-3">
                <div style="width:52px; height:52px; background:rgba(0,136,204,0.1); border-radius:14px; display:flex; align-items:center; justify-content:center; font-size:1.5rem; color:#0088cc; flex-shrink:0;">
                    <i class="bi bi-telegram"></i>
                </div>
                <div>
                    <div style="font-weight:700; font-size:0.95rem; color:var(--dark);">Telegram orqali kirish</div>
                    {% if user.telegram_id %}
                    <div style="font-size:0.78rem; color:#059669; font-weight:600;"><i class="bi bi-check-circle-fill me-1"></i>Ulangan: @{{ user.telegram_username|default:user.first_name }}</div>
                    {% else %}
                    <div style="font-size:0.78rem; color:var(--gray-500);">Telegram bilan bog'lang va oson kiring</div>
                    {% endif %}
                </div>
            </div>
            {% if not user.telegram_id %}
            <a href="{% url 'accounts:telegram_login' %}" class="btn btn-sm" style="background:#0088cc; color:white; border-radius:50px;">Ulash</a>
            {% else %}
            <button class="btn btn-sm btn-light text-danger" disabled>Uzish</button>
            {% endif %}
        </div>
    </div>
</div>

<!-- Danger zone -->
<div class="profile-card" style="border-color:rgba(239,68,68,0.3);">
    <div class="profile-card-body">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <div style="font-weight:700; color:#DC2626; font-size:0.95rem;">Hisobni o'chirish</div>
                <div style="font-size:0.8rem; color:var(--gray-500);">Barcha ma'lumotlaringiz butunlay o'chib ketadi.</div>
            </div>
            <button class="btn btn-sm" style="border:1px solid #DC2626; color:#DC2626; border-radius:50px;">O'chirish</button>
        </div>
    </div>
</div>

{% endblock %}
