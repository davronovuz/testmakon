{% extends 'accounts/profile_base.html' %}
{% load static %}

{% block title %}Yutuqlar | TestMakon{% endblock %}

{% block profile_extra_css %}
<style>
    .badge-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-lg);
        overflow: hidden;
    }
    .badge-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-md); }

    .badge-locked {
        filter: grayscale(100%);
        opacity: 0.6;
        cursor: not-allowed;
    }
    .badge-locked:hover { transform: none; box-shadow: none; }

    .lock-overlay {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0,0,0,0.45);
        color: white;
        width: 40px; height: 40px;
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        font-size: 1.2rem;
        z-index: 2;
    }

    [data-theme="dark"] .badge-card {
        background: #1E293B;
        border-color: #334155;
    }
</style>
{% endblock %}

{% block profile_content %}

<!-- Header -->
<div class="profile-card mb-3">
    <div class="profile-card-header">
        <h5><i class="bi bi-award-fill text-warning"></i> Mening Yutuqlarim</h5>
    </div>
    <div class="profile-card-body">
        <div class="row g-3 align-items-center">
            <div class="col-6 text-center">
                <div style="font-size:2rem; font-weight:800; color:var(--primary-dark);">{{ user_badges.count }}</div>
                <div style="font-size:0.75rem; font-weight:700; color:var(--gray-500); text-transform:uppercase;">Olingan</div>
            </div>
            <div class="col-6 text-center" style="border-left:1px solid var(--gray-200);">
                <div style="font-size:2rem; font-weight:800; color:var(--dark);">{{ all_badges.count }}</div>
                <div style="font-size:0.75rem; font-weight:700; color:var(--gray-500); text-transform:uppercase;">Jami</div>
            </div>
        </div>
        <div style="background:var(--gray-100); border-radius:50px; height:8px; overflow:hidden; margin-top:1rem;">
            {% widthratio user_badges.count all_badges.count 100 as pct %}
            <div style="width:{{ pct }}%; background:var(--gradient-primary); height:100%; border-radius:50px;"></div>
        </div>
        <div style="font-size:0.78rem; color:var(--gray-500); text-align:right; margin-top:4px;">{{ pct }}% to'liq</div>
    </div>
</div>

<!-- Badges Grid -->
<div class="row g-3">
    {% for badge in all_badges %}
    <div class="col-6 col-sm-4 col-md-4">
        {% if badge.id in earned_ids %}
        <div class="badge-card p-3 text-center h-100">
            <div class="position-absolute top-0 end-0 p-2">
                <i class="bi bi-check-circle-fill text-success"></i>
            </div>
            {% if badge.icon %}
            <img src="{{ badge.icon.url }}" alt="{{ badge.name }}" style="max-height:64px; margin-bottom:0.75rem; filter:drop-shadow(0 4px 6px rgba(0,0,0,0.15));">
            {% else %}
            <div style="width:64px; height:64px; background:rgba(245,158,11,0.12); border-radius:16px; display:flex; align-items:center; justify-content:center; margin:0 auto 0.75rem; font-size:1.75rem; color:#D97706;">
                <i class="bi bi-award-fill"></i>
            </div>
            {% endif %}
            <div style="font-weight:700; font-size:0.85rem; color:var(--dark); margin-bottom:0.35rem;">{{ badge.name }}</div>
            <p style="font-size:0.75rem; color:var(--gray-500); margin-bottom:0.5rem; line-height:1.4;">{{ badge.description }}</p>
            <span class="badge rounded-pill" style="background:rgba(139,197,64,0.12); color:var(--primary-dark); font-size:0.72rem;">+{{ badge.xp_reward }} XP</span>
        </div>
        {% else %}
        <div class="badge-card badge-locked p-3 text-center h-100">
            <div class="lock-overlay">
                <i class="bi bi-lock-fill"></i>
            </div>
            {% if badge.icon %}
            <img src="{{ badge.icon.url }}" alt="{{ badge.name }}" style="max-height:64px; margin-bottom:0.75rem; opacity:0.5;">
            {% else %}
            <div style="width:64px; height:64px; background:var(--gray-100); border-radius:16px; display:flex; align-items:center; justify-content:center; margin:0 auto 0.75rem; font-size:1.75rem; color:var(--gray-400);">
                <i class="bi bi-award"></i>
            </div>
            {% endif %}
            <div style="font-weight:700; font-size:0.85rem; color:var(--gray-500); margin-bottom:0.35rem;">{{ badge.name }}</div>
            <p style="font-size:0.72rem; color:var(--gray-400); margin-bottom:0.5rem;">Talab: {{ badge.requirement_value }}</p>
            <span class="badge rounded-pill" style="background:var(--gray-100); color:var(--gray-500); font-size:0.72rem;">{{ badge.xp_reward }} XP</span>
        </div>
        {% endif %}
    </div>
    {% empty %}
    <div class="col-12">
        <div class="profile-card text-center py-5">
            <i class="bi bi-award d-block mb-3" style="font-size:2.5rem; color:var(--gray-300);"></i>
            <p class="text-muted">Hozircha yutuqlar mavjud emas</p>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}
