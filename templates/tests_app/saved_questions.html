{% extends 'base.html' %}
{% load static %}

{% block title %}Saqlangan savollar | TestMakon{% endblock %}

{% block extra_css %}
<style>
    {% include 'tests_app/_sidebar_css.html' %}

    /* ========== CONTENT ========== */
    .saved-content {
        padding: 0;
    }

    .saved-count {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: var(--primary-glow);
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--primary-dark);
        margin-bottom: 1.5rem;
    }

    /* ========== FILTERS ========== */
    .saved-filters {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .saved-filter-group {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .saved-filter-btn {
        padding: 0.5rem 1rem;
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius);
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--dark-600);
        cursor: pointer;
        transition: all 0.2s;
    }

    .saved-filter-btn:hover {
        background: var(--gray-100);
    }

    .saved-filter-btn.active {
        background: var(--primary);
        border-color: var(--primary);
        color: white;
    }

    .saved-actions {
        display: flex;
        gap: 0.5rem;
    }

    /* ========== QUESTIONS LIST ========== */
    .saved-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .saved-item {
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-lg);
        overflow: hidden;
        transition: all 0.2s;
    }

    .saved-item:hover {
        box-shadow: var(--shadow);
        border-color: var(--gray-300);
    }

    .saved-item-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem 1.25rem;
        background: var(--gray-50);
        border-bottom: 1px solid var(--gray-200);
    }

    .saved-item-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .saved-item-subject {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.35rem 0.75rem;
        background: var(--white);
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--dark-600);
    }

    .saved-item-topic {
        font-size: 0.85rem;
        color: var(--gray-500);
    }

    .saved-item-difficulty {
        font-size: 0.8rem;
        font-weight: 600;
        padding: 0.25rem 0.6rem;
        border-radius: 4px;
    }

    .saved-item-difficulty.easy {
        background: #D1FAE5;
        color: #059669;
    }

    .saved-item-difficulty.medium {
        background: #FEF3C7;
        color: #D97706;
    }

    .saved-item-difficulty.hard {
        background: #FEE2E2;
        color: #DC2626;
    }

    .saved-item-date {
        font-size: 0.8rem;
        color: var(--gray-400);
    }

    .saved-item-body {
        padding: 1.25rem;
    }

    .saved-item-question {
        font-size: 1rem;
        color: var(--dark);
        line-height: 1.7;
        margin-bottom: 1rem;
    }

    .saved-item-answers {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .saved-answer {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.6rem 1rem;
        background: var(--gray-50);
        border-radius: var(--radius);
        font-size: 0.9rem;
        color: var(--dark-600);
    }

    .saved-answer.correct {
        background: #D1FAE5;
        color: #059669;
    }

    .saved-answer-letter {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--gray-200);
        border-radius: 50%;
        font-size: 0.75rem;
        font-weight: 700;
        flex-shrink: 0;
    }

    .saved-answer.correct .saved-answer-letter {
        background: #10B981;
        color: white;
    }

    .saved-item-footer {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 0.5rem;
        padding-top: 1rem;
        border-top: 1px solid var(--gray-200);
    }

    .saved-btn {
        padding: 0.5rem 1rem;
        border-radius: var(--radius);
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 0.35rem;
    }

    .saved-btn.outline {
        background: transparent;
        border: 1px solid var(--gray-300);
        color: var(--dark-600);
    }

    .saved-btn.outline:hover {
        background: var(--gray-100);
    }

    .saved-btn.danger {
        background: transparent;
        border: 1px solid #FCA5A5;
        color: #DC2626;
    }

    .saved-btn.danger:hover {
        background: #FEE2E2;
    }

    /* ========== EMPTY STATE ========== */
    .saved-empty {
        text-align: center;
        padding: 4rem 2rem;
        background: var(--white);
        border-radius: var(--radius-lg);
        border: 1px solid var(--gray-200);
    }

    .saved-empty-icon {
        width: 80px;
        height: 80px;
        background: var(--gray-100);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
        font-size: 2rem;
        color: var(--gray-400);
    }

    .saved-empty h3 {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
    }

    .saved-empty p {
        color: var(--gray-500);
        margin-bottom: 1.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="tl-layout">
        {% include 'tests_app/_sidebar.html' with active='saved' %}
        <main>
            {% if saved %}
            <div class="saved-count">
                <i class="bi bi-bookmark-check"></i>
                {{ saved|length }} ta savol saqlangan
            </div>

            <!-- Filters -->
            <div class="saved-filters">
                <div class="saved-filter-group">
                    <button class="saved-filter-btn active" data-filter="all">Barchasi</button>
                    {% regroup saved by question.subject as subject_list %}
                    {% for subject in subject_list %}
                    <button class="saved-filter-btn" data-filter="{{ subject.grouper.slug }}">
                        {{ subject.grouper.icon }} {{ subject.grouper.name }}
                    </button>
                    {% endfor %}
                </div>

                <div class="saved-actions">
                    <a href="{% url 'tests_app:practice_select' %}" class="btn btn-primary btn-sm">
                        <i class="bi bi-play-fill me-1"></i>Mashq qilish
                    </a>
                </div>
            </div>

            <!-- Questions List -->
            <div class="saved-list">
                {% for item in saved %}
                <div class="saved-item" data-subject="{{ item.question.subject.slug }}">
                    <div class="saved-item-header">
                        <div class="saved-item-meta">
                            <span class="saved-item-subject">
                                {{ item.question.subject.icon }}
                                {{ item.question.subject.name }}
                            </span>
                            {% if item.question.topic %}
                            <span class="saved-item-topic">{{ item.question.topic.name }}</span>
                            {% endif %}
                            <span class="saved-item-difficulty {{ item.question.difficulty }}">
                                {% if item.question.difficulty == 'easy' %}Oson
                                {% elif item.question.difficulty == 'medium' %}O'rta
                                {% elif item.question.difficulty == 'hard' %}Qiyin
                                {% else %}Ekspert{% endif %}
                            </span>
                        </div>
                        <span class="saved-item-date">
                            <i class="bi bi-calendar3 me-1"></i>
                            {{ item.created_at|date:"d.m.Y" }}
                        </span>
                    </div>

                    <div class="saved-item-body">
                        <div class="saved-item-question">
                            {{ item.question.text }}
                        </div>

                        <div class="saved-item-answers">
                            {% for answer in item.question.answers.all %}
                            <div class="saved-answer {% if answer.is_correct %}correct{% endif %}">
                                <span class="saved-answer-letter">
                                    {% if forloop.counter == 1 %}A{% elif forloop.counter == 2 %}B{% elif forloop.counter == 3 %}C{% else %}D{% endif %}
                                </span>
                                {{ answer.text }}
                                {% if answer.is_correct %}
                                <i class="bi bi-check-circle-fill ms-auto"></i>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>

                        <div class="saved-item-footer">
                            <a href="{% url 'tests_app:unsave_question' question_id=item.question.id %}" class="saved-btn danger">
                                <i class="bi bi-bookmark-x"></i>
                                O'chirish
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            {% else %}
            <!-- Empty State -->
            <div class="saved-empty">
                <div class="saved-empty-icon">
                    <i class="bi bi-bookmark"></i>
                </div>
                <h3>Saqlangan savollar yo'q</h3>
                <p>Test paytida savollarni belgilab saqlab qo'yishingiz mumkin</p>
                <a href="{% url 'tests_app:question_bank' %}" class="btn btn-primary">
                    <i class="bi bi-play-fill me-2"></i>Test boshlash
                </a>
            </div>
            {% endif %}
        </main>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Filter by subject
    document.querySelectorAll('.saved-filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const filter = this.dataset.filter;

            document.querySelectorAll('.saved-filter-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');

            document.querySelectorAll('.saved-item').forEach(item => {
                if (filter === 'all' || item.dataset.subject === filter) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    });
</script>
{% endblock %}
