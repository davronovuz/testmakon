{% extends 'base.html' %}
{% load static %}

{% block title %}{{ test.title }} | TestMakon{% endblock %}

{% block extra_css %}
<style>
    /* ========== HEADER ========== */
    .td-header {
        padding: 3rem 0;
        color: white;
    }

    /* Subject gradients */
    .td-header.matematika { background: linear-gradient(135deg, #FBBF24 0%, #F59E0B 100%); }
    .td-header.fizika { background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%); }
    .td-header.kimyo { background: linear-gradient(135deg, #8B5CF6 0%, #6D28D9 100%); }
    .td-header.biologiya { background: linear-gradient(135deg, #10B981 0%, #059669 100%); }
    .td-header.ingliz-tili { background: linear-gradient(135deg, #EC4899 0%, #DB2777 100%); }
    .td-header.tarix { background: linear-gradient(135deg, #F97316 0%, #EA580C 100%); }
    .td-header.geografiya { background: linear-gradient(135deg, #14B8A6 0%, #0D9488 100%); }
    .td-header.ona-tili { background: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%); }
    .td-header.default { background: var(--gradient-dark); }

    .td-breadcrumb {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        margin-bottom: 1rem;
        opacity: 0.9;
    }

    .td-breadcrumb a {
        color: white;
        opacity: 0.8;
    }

    .td-breadcrumb a:hover {
        opacity: 1;
    }

    .td-header h1 {
        font-size: 2rem;
        color: white;
        margin-bottom: 0.75rem;
    }

    .td-header-meta {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        flex-wrap: wrap;
    }

    .td-header-stat {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.95rem;
        background: rgba(255,255,255,0.15);
        padding: 0.5rem 1rem;
        border-radius: var(--radius);
    }

    .td-type-badge {
        padding: 0.35rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
    }

    .td-type-badge.practice {
        background: rgba(255,255,255,0.2);
    }

    .td-type-badge.exam {
        background: #DC2626;
    }

    /* ========== CONTENT ========== */
    .td-content {
        padding: 2.5rem 0;
    }

    .td-grid {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 2rem;
    }

    @media (max-width: 992px) {
        .td-grid {
            grid-template-columns: 1fr;
        }
    }

    /* ========== CARDS ========== */
    .td-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-200);
        overflow: hidden;
        margin-bottom: 1.5rem;
    }

    .td-card-header {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--gray-200);
    }

    .td-card-title {
        font-size: 1rem;
        font-weight: 700;
        color: var(--dark);
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .td-card-title i {
        color: var(--primary);
    }

    .td-card-body {
        padding: 1.5rem;
    }

    /* ========== INFO LIST ========== */
    .td-info-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .td-info-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--gray-100);
    }

    .td-info-item:last-child {
        border-bottom: none;
    }

    .td-info-label {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 0.95rem;
        color: var(--gray-500);
    }

    .td-info-label i {
        font-size: 1.1rem;
        width: 20px;
        text-align: center;
    }

    .td-info-value {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--dark);
    }

    /* ========== PREVIOUS ATTEMPTS ========== */
    .td-attempt-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem;
        background: var(--gray-50);
        border-radius: var(--radius);
        margin-bottom: 0.75rem;
    }

    .td-attempt-item:last-child {
        margin-bottom: 0;
    }

    .td-attempt-score {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 0.9rem;
    }

    .td-attempt-score.excellent {
        background: #D1FAE5;
        color: #059669;
    }

    .td-attempt-score.good {
        background: var(--primary-glow);
        color: var(--primary-dark);
    }

    .td-attempt-score.average {
        background: #FEF3C7;
        color: #D97706;
    }

    .td-attempt-score.poor {
        background: #FEE2E2;
        color: #DC2626;
    }

    .td-attempt-info {
        flex: 1;
        margin-left: 1rem;
    }

    .td-attempt-date {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--dark);
    }

    .td-attempt-stats {
        font-size: 0.8rem;
        color: var(--gray-500);
    }

    .td-attempt-btn {
        padding: 0.4rem 0.75rem;
        font-size: 0.8rem;
    }

    /* ========== SIDEBAR ========== */
    .td-sidebar {
        position: sticky;
        top: 100px;
        align-self: start;
    }

    .td-start-card {
        background: var(--white);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        box-shadow: var(--shadow);
        border: 1px solid var(--gray-200);
        text-align: center;
    }

    .td-start-icon {
        width: 64px;
        height: 64px;
        background: var(--primary-glow);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        font-size: 1.5rem;
        color: var(--primary-dark);
    }

    .td-start-card h3 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }

    .td-start-card p {
        font-size: 0.9rem;
        color: var(--gray-500);
        margin-bottom: 1.5rem;
    }

    .td-start-btn {
        width: 100%;
        padding: 1rem;
        font-size: 1rem;
        background: var(--gradient-primary);
        color: white;
        border: none;
        border-radius: var(--radius-lg);
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        transition: all 0.3s;
    }

    .td-start-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-primary);
        color: white;
    }

    /* ========== TIPS ========== */
    .td-tips {
        margin-top: 1.5rem;
    }

    .td-tip {
        display: flex;
        gap: 0.75rem;
        padding: 0.75rem;
        background: var(--gray-50);
        border-radius: var(--radius);
        margin-bottom: 0.5rem;
        font-size: 0.85rem;
        color: var(--dark-600);
    }

    .td-tip i {
        color: var(--primary);
        flex-shrink: 0;
    }
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="td-header {{ test.subject.slug|default:'default' }}">
    <div class="container">
        <div class="td-breadcrumb">
            <a href="{% url 'tests_app:tests_list' %}">Testlar</a>
            <i class="bi bi-chevron-right"></i>
            <span>{{ test.title }}</span>
        </div>

        <h1>{{ test.title }}</h1>

        <div class="td-header-meta">
            <span class="td-type-badge {{ test.test_type }}">
                {% if test.test_type == 'practice' %}Mashq
                {% elif test.test_type == 'exam' %}Imtihon
                {% elif test.test_type == 'block' %}Blok test
                {% else %}Test{% endif %}
            </span>

            {% if test.subject %}
            <div class="td-header-stat">
                {{ test.subject.icon }}
                {{ test.subject.name }}
            </div>
            {% endif %}

            <div class="td-header-stat">
                <i class="bi bi-journal-text"></i>
                {{ test.question_count }} savol
            </div>

            {% if test.time_limit %}
            <div class="td-header-stat">
                <i class="bi bi-clock"></i>
                {{ test.time_limit }} daqiqa
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Content -->
<div class="td-content">
    <div class="container">
        <div class="td-grid">
            <!-- Main -->
            <div class="td-main">
                <!-- Test Info -->
                <div class="td-card">
                    <div class="td-card-header">
                        <h3 class="td-card-title">
                            <i class="bi bi-info-circle"></i>
                            Test haqida
                        </h3>
                    </div>
                    <div class="td-card-body">
                        <div class="td-info-list">
                            <div class="td-info-item">
                                <span class="td-info-label">
                                    <i class="bi bi-journal-text"></i>
                                    Savollar soni
                                </span>
                                <span class="td-info-value">{{ test.question_count }} ta</span>
                            </div>

                            <div class="td-info-item">
                                <span class="td-info-label">
                                    <i class="bi bi-clock"></i>
                                    Vaqt chegarasi
                                </span>
                                <span class="td-info-value">
                                    {% if test.time_limit %}{{ test.time_limit }} daqiqa{% else %}Chegarasiz{% endif %}
                                </span>
                            </div>

                            <div class="td-info-item">
                                <span class="td-info-label">
                                    <i class="bi bi-shuffle"></i>
                                    Savollar tartibi
                                </span>
                                <span class="td-info-value">
                                    {% if test.shuffle_questions %}Aralash{% else %}Belgilangan{% endif %}
                                </span>
                            </div>

                            <div class="td-info-item">
                                <span class="td-info-label">
                                    <i class="bi bi-eye"></i>
                                    Javoblarni ko'rsatish
                                </span>
                                <span class="td-info-value">
                                    {% if test.show_correct_answers %}Ha{% else %}Yo'q{% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                {% if test.description %}
                <div class="td-card">
                    <div class="td-card-header">
                        <h3 class="td-card-title">
                            <i class="bi bi-text-paragraph"></i>
                            Tavsif
                        </h3>
                    </div>
                    <div class="td-card-body">
                        <p class="mb-0">{{ test.description }}</p>
                    </div>
                </div>
                {% endif %}

                <!-- Previous Attempts -->
                {% if user_attempts %}
                <div class="td-card">
                    <div class="td-card-header">
                        <h3 class="td-card-title">
                            <i class="bi bi-clock-history"></i>
                            Oldingi urinishlar
                        </h3>
                    </div>
                    <div class="td-card-body">
                        {% for attempt in user_attempts %}
                        <div class="td-attempt-item">
                            <div class="td-attempt-score {% if attempt.percentage >= 90 %}excellent{% elif attempt.percentage >= 70 %}good{% elif attempt.percentage >= 50 %}average{% else %}poor{% endif %}">
                                {{ attempt.percentage|floatformat:0 }}%
                            </div>
                            <div class="td-attempt-info">
                                <div class="td-attempt-date">{{ attempt.completed_at|date:"d.m.Y H:i" }}</div>
                                <div class="td-attempt-stats">
                                    {{ attempt.correct_answers }}/{{ attempt.total_questions }} to'g'ri
                                </div>
                            </div>
                            <a href="{% url 'tests_app:test_play_result' uuid=attempt.uuid %}" class="btn btn-light td-attempt-btn">
                                Ko'rish
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div class="td-sidebar">
                <div class="td-start-card">
                    <div class="td-start-icon">
                        <i class="bi bi-play-fill"></i>
                    </div>
                    <h3>Testni boshlash</h3>
                    <p>Tayyor bo'lsangiz boshlang. Omad!</p>

                    <a href="{% url 'tests_app:test_start' slug=test.slug %}" class="td-start-btn">
                        <i class="bi bi-play-fill"></i>
                        Boshlash
                    </a>

                    <div class="td-tips">
                        <div class="td-tip">
                            <i class="bi bi-lightbulb"></i>
                            <span>Savollarni diqqat bilan o'qing</span>
                        </div>
                        <div class="td-tip">
                            <i class="bi bi-bookmark"></i>
                            <span>Qiyin savollarni belgilab qo'ying</span>
                        </div>
                        <div class="td-tip">
                            <i class="bi bi-clock"></i>
                            <span>Vaqtni nazorat qiling</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}