{% extends 'base.html' %}
{% load static %}

{% block title %}Testlar | TestMakon{% endblock %}

{% block extra_css %}
<style>
    {% include 'includes/_sidebar_css.html' %}

    .tl-main-head {
        display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.25rem;
    }
    .tl-main-title { font-size: 1.2rem; font-weight: 900; color: var(--dark); margin: 0; }
    .tl-main-count { font-size: 0.8rem; font-weight: 600; color: var(--gray-400); }

    /* ===== Subject filter chips ===== */
    .tl-filters {
        display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 1.25rem;
    }
    .tl-chip {
        padding: 6px 14px; border-radius: 20px; font-size: 0.78rem; font-weight: 600;
        border: 1px solid var(--gray-200); background: var(--white); color: var(--dark-600);
        cursor: pointer; transition: all 0.15s ease; text-decoration: none;
        display: inline-flex; align-items: center; gap: 4px;
    }
    .tl-chip:hover { border-color: var(--primary); color: var(--primary-dark); background: rgba(139,197,64,0.06); }
    .tl-chip.active { background: var(--primary); color: white; border-color: var(--primary); }

    /* ===== Mode cards (when no tests) ===== */
    .tl-modes {
        display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 1.5rem;
    }
    .tl-mode {
        background: var(--white); border: 1px solid var(--gray-200); border-radius: 14px;
        padding: 1.25rem; text-decoration: none; color: inherit;
        display: flex; align-items: flex-start; gap: 14px;
        transition: all 0.2s ease; position: relative; overflow: hidden;
    }
    .tl-mode:hover {
        border-color: var(--gray-300); box-shadow: 0 4px 16px rgba(0,0,0,0.06);
        transform: translateY(-2px); color: inherit;
    }
    .tl-mode-icon {
        width: 44px; height: 44px; border-radius: 12px;
        display: flex; align-items: center; justify-content: center;
        font-size: 1.15rem; flex-shrink: 0;
    }
    .tl-mode-icon.green { background: rgba(139,197,64,0.12); color: var(--primary-dark); }
    .tl-mode-icon.blue { background: rgba(59,130,246,0.1); color: #2563EB; }
    .tl-mode-icon.purple { background: rgba(139,92,246,0.1); color: #7C3AED; }
    .tl-mode-icon.amber { background: rgba(245,158,11,0.1); color: #D97706; }
    .tl-mode-icon.red { background: rgba(239,68,68,0.1); color: #DC2626; }
    .tl-mode-icon.dark { background: var(--gray-100); color: var(--dark); }
    .tl-mode-body h3 { font-size: 0.88rem; font-weight: 800; color: var(--dark); margin: 0 0 4px; }
    .tl-mode-body p { font-size: 0.75rem; color: var(--gray-500); margin: 0; line-height: 1.4; }
    .tl-mode-arrow {
        position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
        color: var(--gray-300); font-size: 0.85rem; transition: all 0.15s ease;
    }
    .tl-mode:hover .tl-mode-arrow { color: var(--primary); right: 10px; }

    /* ===== Subject list (compact) ===== */
    .tl-subj-title {
        font-size: 0.72rem; font-weight: 800; text-transform: uppercase;
        letter-spacing: 0.05em; color: var(--gray-400); margin-bottom: 10px;
    }
    .tl-subj-grid {
        display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 1.5rem;
    }
    .tl-subj-item {
        display: flex; align-items: center; gap: 10px; padding: 10px 12px;
        background: var(--white); border: 1px solid var(--gray-200); border-radius: 10px;
        text-decoration: none; color: inherit; transition: all 0.15s ease;
    }
    .tl-subj-item:hover {
        border-color: var(--gray-300); box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        color: inherit;
    }
    .tl-subj-icon {
        width: 34px; height: 34px; border-radius: 9px;
        display: flex; align-items: center; justify-content: center; font-size: 1rem;
    }
    .tl-subj-name { font-size: 0.8rem; font-weight: 700; color: var(--dark); }
    .tl-subj-count { font-size: 0.7rem; color: var(--gray-400); font-weight: 500; }

    /* ===== Test card grid ===== */
    .tl-grid {
        display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 10px;
    }
    .tl-card {
        background: var(--white); border: 1px solid var(--gray-200); border-radius: 12px;
        padding: 1rem; display: flex; flex-direction: column;
        transition: all 0.2s ease; text-decoration: none; color: inherit;
    }
    .tl-card:hover {
        border-color: var(--gray-300); box-shadow: 0 4px 12px rgba(0,0,0,0.06);
        transform: translateY(-1px); color: inherit;
    }
    .tl-card-top {
        display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;
    }
    .tl-card-subj {
        display: inline-flex; align-items: center; gap: 4px;
        font-size: 0.7rem; font-weight: 600; color: var(--gray-500);
    }
    .tl-card-subj span { font-size: 0.85rem; }
    .tl-badge {
        font-size: 0.6rem; font-weight: 800; padding: 2px 8px; border-radius: 5px;
        text-transform: uppercase; letter-spacing: 0.03em;
    }
    .tl-badge.practice { background: #ECFDF5; color: #059669; }
    .tl-badge.exam { background: #FEF2F2; color: #DC2626; }
    .tl-badge.block { background: #EFF6FF; color: #2563EB; }
    .tl-badge.test { background: var(--gray-100); color: var(--dark-600); }
    .tl-card-title {
        font-size: 0.85rem; font-weight: 800; color: var(--dark); margin-bottom: 8px; line-height: 1.35;
    }
    .tl-card-info {
        display: flex; align-items: center; gap: 10px;
        font-size: 0.72rem; font-weight: 500; color: var(--gray-500); margin-bottom: 10px;
    }
    .tl-card-info span { display: inline-flex; align-items: center; gap: 3px; }
    .tl-card-info i { font-size: 0.72rem; color: var(--gray-400); }
    .tl-card-bottom {
        margin-top: auto; padding-top: 8px; border-top: 1px solid var(--gray-100);
        display: flex; align-items: center; justify-content: space-between;
    }
    .tl-card-attempts {
        font-size: 0.7rem; font-weight: 600; color: var(--gray-400);
        display: flex; align-items: center; gap: 4px;
    }
    .tl-card-btn {
        display: inline-flex; align-items: center; gap: 4px;
        padding: 6px 14px; background: var(--gradient-primary); color: var(--white);
        border-radius: var(--radius); font-size: 0.72rem; font-weight: 700;
        box-shadow: 0 2px 8px rgba(139,197,64,0.15); transition: all 0.15s ease;
    }
    .tl-card:hover .tl-card-btn { box-shadow: var(--shadow-primary); }

    .tl-empty {
        grid-column: 1 / -1; text-align: center; padding: 3rem 2rem;
        background: var(--white); border: 1px solid var(--gray-200); border-radius: 14px;
    }
    .tl-empty-icon {
        width: 56px; height: 56px; background: var(--gray-50); border-radius: 14px;
        display: flex; align-items: center; justify-content: center; margin: 0 auto 0.75rem;
    }
    .tl-empty-icon i { font-size: 1.3rem; color: var(--gray-400); }
    .tl-empty h3 { font-size: 0.95rem; font-weight: 800; margin-bottom: 0.25rem; }
    .tl-empty p { font-size: 0.78rem; color: var(--gray-500); max-width: 260px; margin: 0 auto; }

    @media (max-width: 768px) {
        .tl-modes { grid-template-columns: 1fr; }
        .tl-subj-grid { grid-template-columns: 1fr; }
        .tl-grid { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="tl-layout">
        {% include 'includes/_sidebar.html' with active='tests_list' %}

        <main>
            <div class="tl-main-head">
                <h1 class="tl-main-title">Testlar</h1>
            </div>

            <!-- Test rejimlari -->
            <div class="tl-modes">
                <a href="{% url 'tests_app:practice_select' %}" class="tl-mode">
                    <div class="tl-mode-icon green"><i class="bi bi-lightning-charge-fill"></i></div>
                    <div class="tl-mode-body">
                        <h3>Mashq qilish</h3>
                        <p>Fan va mavzu tanlang, bilimingizni mustahkamlang</p>
                    </div>
                    <i class="bi bi-chevron-right tl-mode-arrow"></i>
                </a>
                <a href="{% url 'tests_app:dtm_simulation' %}" class="tl-mode">
                    <div class="tl-mode-icon dark"><i class="bi bi-mortarboard-fill"></i></div>
                    <div class="tl-mode-body">
                        <h3>DTM simulyatsiya</h3>
                        <p>Haqiqiy imtihon formatida tayyorlaning</p>
                    </div>
                    <i class="bi bi-chevron-right tl-mode-arrow"></i>
                </a>
                <a href="{% url 'tests_app:quick_test' %}" class="tl-mode">
                    <div class="tl-mode-icon amber"><i class="bi bi-stopwatch-fill"></i></div>
                    <div class="tl-mode-body">
                        <h3>Tezkor test</h3>
                        <p>10 ta tasodifiy savol, tez natija</p>
                    </div>
                    <i class="bi bi-chevron-right tl-mode-arrow"></i>
                </a>
                <a href="{% url 'tests_app:question_bank' %}" class="tl-mode">
                    <div class="tl-mode-icon purple"><i class="bi bi-collection-fill"></i></div>
                    <div class="tl-mode-body">
                        <h3>Savol banki</h3>
                        <p>Barcha fanlar va mavzular bo'yicha savollar</p>
                    </div>
                    <i class="bi bi-chevron-right tl-mode-arrow"></i>
                </a>
            </div>

            <!-- Fanlar -->
            {% if subjects %}
            <div class="tl-subj-title">Fanlar bo'yicha</div>
            <div class="tl-subj-grid">
                {% for subject in subjects %}
                <a href="{% url 'tests_app:practice_select' %}?subject={{ subject.slug }}" class="tl-subj-item">
                    <div class="tl-subj-icon" style="background: {{ subject.color }}15; color: {{ subject.color }}">
                        {{ subject.icon }}
                    </div>
                    <div>
                        <div class="tl-subj-name">{{ subject.name }}</div>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Testlar ro'yxati -->
            {% if tests %}
            <div class="tl-subj-title">Tayyor testlar</div>
            <div class="tl-grid">
                {% for test in tests %}
                <a href="{% url 'tests_app:test_detail' slug=test.slug %}" class="tl-card">
                    <div class="tl-card-top">
                        <div class="tl-card-subj">
                            <span>{{ test.subject.icon|default:"ðŸ“š" }}</span>
                            {{ test.subject.name|default:"Umumiy" }}
                        </div>
                        <span class="tl-badge {{ test.test_type }}">
                            {% if test.test_type == 'practice' %}Mashq
                            {% elif test.test_type == 'exam' %}Imtihon
                            {% elif test.test_type == 'block' %}Blok
                            {% else %}Test{% endif %}
                        </span>
                    </div>
                    <h3 class="tl-card-title">{{ test.title }}</h3>
                    <div class="tl-card-info">
                        <span><i class="bi bi-journal-text"></i> {{ test.question_count }} savol</span>
                        {% if test.time_limit %}
                        <span><i class="bi bi-clock"></i> {{ test.time_limit }} daq</span>
                        {% endif %}
                    </div>
                    <div class="tl-card-bottom">
                        <span class="tl-card-attempts">
                            <i class="bi bi-people-fill"></i> {{ test.total_attempts|default:"0" }}
                        </span>
                        <span class="tl-card-btn">Boshlash <i class="bi bi-arrow-right"></i></span>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% endif %}
        </main>
    </div>
</div>
{% endblock %}
