{% extends 'base.html' %}
{% load static %}

{% block title %}{% if edit %}Testni tahrirlash{% else %}Yangi test{% endif %} | TestMakon{% endblock %}

{% block extra_css %}
<style>
.mf-page { max-width:760px; margin:0 auto; padding:2rem 1rem; }
.mf-header { display:flex; align-items:center; gap:1rem; margin-bottom:1.5rem; }
.mf-back { display:inline-flex; align-items:center; gap:0.4rem; padding:0.4rem 0.8rem; border-radius:8px; background:#fff; border:1px solid var(--gray-200); color:var(--dark-600); font-size:0.82rem; font-weight:700; text-decoration:none; }
.mf-title { font-size:1.3rem; font-weight:900; color:var(--dark); margin:0; }
.mf-card { background:#fff; border:1px solid var(--gray-200); border-radius:16px; padding:1.75rem; }
.mf-section { font-size:0.72rem; font-weight:800; color:var(--gray-400); text-transform:uppercase; letter-spacing:0.5px; margin:1.5rem 0 0.75rem; border-bottom:1px solid var(--gray-100); padding-bottom:0.4rem; }
.mf-section:first-child { margin-top:0; }
.mf-grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
.mf-group { display:flex; flex-direction:column; gap:0.35rem; }
.mf-label { font-size:0.8rem; font-weight:700; color:var(--dark); }
.mf-input { padding:0.6rem 0.9rem; border:1px solid var(--gray-200); border-radius:9px; font-size:0.88rem; color:var(--dark); outline:none; background:#fff; width:100%; box-sizing:border-box; }
.mf-input:focus { border-color:var(--primary); box-shadow:0 0 0 3px rgba(139,197,64,0.12); }
.mf-textarea { resize:vertical; min-height:80px; }
.mf-check-row { display:flex; align-items:center; gap:0.6rem; padding:0.6rem 0; }
.mf-check-row input[type=checkbox] { width:18px; height:18px; accent-color:var(--primary); }
.mf-check-row label { font-size:0.85rem; font-weight:600; color:var(--dark-600); cursor:pointer; }
.mf-footer { display:flex; gap:0.75rem; margin-top:1.5rem; }
.mf-btn { display:inline-flex; align-items:center; gap:0.4rem; padding:0.65rem 1.4rem; border-radius:10px; font-size:0.9rem; font-weight:800; border:none; cursor:pointer; text-decoration:none; }
.mf-btn.primary { background:var(--gradient-primary); color:#fff; box-shadow:0 4px 15px rgba(139,197,64,0.3); }
.mf-btn.outline { background:#fff; border:1px solid var(--gray-200); color:var(--dark-600); }
@media(max-width:576px) { .mf-grid { grid-template-columns:1fr; } }
</style>
{% endblock %}

{% block content %}
<div style="background:var(--gray-50); min-height:100vh;">
<div class="mf-page">

  <div class="mf-header">
    <a href="{% url 'tests_app:manage_tests_list' %}" class="mf-back"><i class="bi bi-arrow-left"></i> Orqaga</a>
    <h1 class="mf-title">{% if edit %}Testni tahrirlash{% else %}Yangi test yaratish{% endif %}</h1>
  </div>

  <form method="post">
    {% csrf_token %}
    <div class="mf-card">

      <div class="mf-section">Asosiy ma'lumotlar</div>

      <div class="mf-group" style="margin-bottom:1rem;">
        <label class="mf-label">Sarlavha <span style="color:#DC2626;">*</span></label>
        <input type="text" name="title" class="mf-input" value="{{ test.title|default:'' }}" placeholder="Masalan: Matematika — 9-sinf imtihoni" required>
      </div>

      <div class="mf-group" style="margin-bottom:1rem;">
        <label class="mf-label">Tavsif</label>
        <textarea name="description" class="mf-input mf-textarea" placeholder="Qisqacha tavsif...">{{ test.description|default:'' }}</textarea>
      </div>

      <div class="mf-grid" style="margin-bottom:1rem;">
        <div class="mf-group">
          <label class="mf-label">Fan</label>
          <select name="subject" class="mf-input">
            <option value="">— Tanlang —</option>
            {% for s in subjects %}
            <option value="{{ s.id }}" {% if test.subject_id == s.id %}selected{% endif %}>{{ s.icon }} {{ s.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="mf-group">
          <label class="mf-label">Test turi</label>
          <select name="test_type" class="mf-input">
            {% for val, label in test_types %}
            <option value="{{ val }}" {% if test.test_type == val %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="mf-section">Sozlamalar</div>

      <div class="mf-grid" style="margin-bottom:1rem;">
        <div class="mf-group">
          <label class="mf-label">Vaqt (daqiqa)</label>
          <input type="number" name="time_limit" class="mf-input" value="{{ test.time_limit|default:60 }}" min="1" max="300">
        </div>
        <div class="mf-group">
          <label class="mf-label">Savollar soni</label>
          <input type="number" name="question_count" class="mf-input" value="{{ test.question_count|default:30 }}" min="1" max="100">
        </div>
        <div class="mf-group">
          <label class="mf-label">O'tish bali (%)</label>
          <input type="number" name="passing_score" class="mf-input" value="{{ test.passing_score|default:60 }}" min="0" max="100">
        </div>
      </div>

      <div class="mf-section">Qo'shimcha</div>

      <div class="mf-check-row">
        <input type="checkbox" name="shuffle_questions" id="shuffle_q" {% if edit and test.shuffle_questions or not edit %}checked{% endif %}>
        <label for="shuffle_q">Savollarni aralashtirish</label>
      </div>
      <div class="mf-check-row">
        <input type="checkbox" name="shuffle_answers" id="shuffle_a" {% if edit and test.shuffle_answers or not edit %}checked{% endif %}>
        <label for="shuffle_a">Javoblarni aralashtirish</label>
      </div>
      <div class="mf-check-row">
        <input type="checkbox" name="show_correct_answers" id="show_ans" {% if edit and test.show_correct_answers or not edit %}checked{% endif %}>
        <label for="show_ans">Natijada to'g'ri javoblarni ko'rsatish</label>
      </div>
      <div class="mf-check-row">
        <input type="checkbox" name="is_active" id="is_active" {% if edit and test.is_active or not edit %}checked{% endif %}>
        <label for="is_active">Faol (foydalanuvchilarga ko'rinadi)</label>
      </div>
      <div class="mf-check-row">
        <input type="checkbox" name="is_premium" id="is_premium" {% if edit and test.is_premium %}checked{% endif %}>
        <label for="is_premium"><i class="bi bi-star-fill" style="color:#FBBF24;"></i> Premium test</label>
      </div>

    </div>

    <div class="mf-footer">
      <button type="submit" class="mf-btn primary">
        <i class="bi bi-{% if edit %}check-lg{% else %}plus-lg{% endif %}"></i>
        {% if edit %}Saqlash{% else %}Yaratish{% endif %}
      </button>
      <a href="{% url 'tests_app:manage_tests_list' %}" class="mf-btn outline">Bekor qilish</a>
    </div>
  </form>

</div>
</div>
{% endblock %}
