{% extends 'base.html' %}
{% load static %}

{% block title %}Xatolar ustida ishlash | TestMakon{% endblock %}

{% block extra_css %}
<style>
    {% include 'includes/_sidebar_css.html' %}

    /* ========== CONTENT ========== */
    .wrong-content {
        padding: 0;
    }

    /* ========== ACTION CARD ========== */
    .wrong-action-card {
        background: var(--gradient-primary);
        border-radius: var(--radius-xl);
        padding: 2rem;
        color: white;
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1.5rem;
    }

    .wrong-action-content h3 {
        font-size: 1.25rem;
        color: white;
        margin-bottom: 0.5rem;
    }

    .wrong-action-content p {
        color: rgba(255,255,255,0.9);
        margin: 0;
    }

    .wrong-action-btn {
        padding: 1rem 2rem;
        background: white;
        color: var(--primary-dark);
        border: none;
        border-radius: var(--radius-lg);
        font-size: 1rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s;
    }

    .wrong-action-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
        color: var(--primary-dark);
    }

    /* ========== FILTERS ========== */
    .wrong-filters {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .wrong-filter-group {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .wrong-filter-btn {
        padding: 0.5rem 1rem;
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius);
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--dark-600);
        cursor: pointer;
        transition: all 0.2s;
    }

    .wrong-filter-btn:hover {
        background: var(--gray-100);
    }

    .wrong-filter-btn.active {
        background: #DC2626;
        border-color: #DC2626;
        color: white;
    }

    /* ========== WRONG LIST ========== */
    .wrong-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .wrong-item {
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-left: 4px solid #EF4444;
        border-radius: var(--radius-lg);
        overflow: hidden;
        transition: all 0.2s;
    }

    .wrong-item:hover {
        box-shadow: var(--shadow);
    }

    .wrong-item-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem 1.25rem;
        background: var(--gray-50);
        border-bottom: 1px solid var(--gray-200);
    }

    .wrong-item-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .wrong-item-subject {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.35rem 0.75rem;
        background: var(--white);
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .wrong-item-topic {
        font-size: 0.85rem;
        color: var(--gray-500);
    }

    .wrong-item-date {
        font-size: 0.8rem;
        color: var(--gray-400);
    }

    .wrong-item-body {
        padding: 1.25rem;
    }

    .wrong-item-question {
        font-size: 1rem;
        color: var(--dark);
        line-height: 1.7;
        margin-bottom: 1.25rem;
    }

    .wrong-item-answers {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .wrong-answer {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        border-radius: var(--radius);
        font-size: 0.9rem;
    }

    .wrong-answer.user-selected {
        background: #FEE2E2;
        border: 1px solid #FECACA;
        color: #991B1B;
    }

    .wrong-answer.correct {
        background: #D1FAE5;
        border: 1px solid #A7F3D0;
        color: #065F46;
    }

    .wrong-answer.neutral {
        background: var(--gray-50);
        color: var(--dark-600);
    }

    .wrong-answer-letter {
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-size: 0.8rem;
        font-weight: 700;
        flex-shrink: 0;
    }

    .wrong-answer.user-selected .wrong-answer-letter {
        background: #DC2626;
        color: white;
    }

    .wrong-answer.correct .wrong-answer-letter {
        background: #10B981;
        color: white;
    }

    .wrong-answer.neutral .wrong-answer-letter {
        background: var(--gray-200);
        color: var(--dark-600);
    }

    .wrong-answer-label {
        font-size: 0.75rem;
        font-weight: 600;
        margin-left: auto;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
    }

    .wrong-answer.user-selected .wrong-answer-label {
        background: #DC2626;
        color: white;
    }

    .wrong-answer.correct .wrong-answer-label {
        background: #10B981;
        color: white;
    }

    @media (max-width: 768px) {
        .wrong-action-card { padding: 1.25rem; flex-direction: column; text-align: center; gap: 1rem; }
        .wrong-action-btn { width: 100%; justify-content: center; }
        .wrong-item-header { flex-wrap: wrap; gap: 0.5rem; }
        .wrong-item-meta { flex-wrap: wrap; gap: 0.4rem; }
        .wrong-item-date { font-size: 0.75rem; }
    }

    @media (max-width: 576px) {
        .wrong-filters { flex-direction: column; align-items: flex-start; }
        .wrong-item-body { padding: 1rem; }
        .wrong-answer { padding: 0.6rem 0.75rem; font-size: 0.85rem; }
        .wrong-answer-label { display: none; }
        .wrong-empty { padding: 2rem 1rem; }
    }

    /* ========== EMPTY STATE ========== */
    .wrong-empty {
        text-align: center;
        padding: 4rem 2rem;
        background: var(--white);
        border-radius: var(--radius-lg);
        border: 1px solid var(--gray-200);
    }

    .wrong-empty-icon {
        width: 80px;
        height: 80px;
        background: #D1FAE5;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
        font-size: 2rem;
        color: #10B981;
    }

    .wrong-empty h3 {
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
        color: #065F46;
    }

    .wrong-empty p {
        color: var(--gray-500);
        margin-bottom: 1.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="tl-layout">
        {% include 'includes/_sidebar.html' with active='wrong_answers' %}
        <main>
            {% if wrong_answers %}
            <!-- Action Card -->
            <div class="wrong-action-card">
                <div class="wrong-action-content">
                    <h3>ðŸŽ¯ Xatolarni to'g'irlang!</h3>
                    <p>Barcha noto'g'ri javoblar bo'yicha mashq qiling</p>
                </div>
                <a href="{% url 'tests_app:wrong_answers_practice' %}" class="wrong-action-btn">
                    <i class="bi bi-arrow-repeat"></i>
                    Mashq boshlash
                </a>
            </div>

            <!-- Filters -->
            <div class="wrong-filters">
                <div class="wrong-filter-group">
                    <button class="wrong-filter-btn active" data-filter="all">Barchasi</button>
                </div>
            </div>

            <!-- Wrong Answers List -->
            <div class="wrong-list">
                {% for item in wrong_answers %}
                <div class="wrong-item">
                    <div class="wrong-item-header">
                        <div class="wrong-item-meta">
                            <span class="wrong-item-subject">
                                {{ item.question.subject.icon }}
                                {{ item.question.subject.name }}
                            </span>
                            {% if item.question.topic %}
                            <span class="wrong-item-topic">{{ item.question.topic.name }}</span>
                            {% endif %}
                        </div>
                        <span class="wrong-item-date">
                            {{ item.answered_at|date:"d.m.Y H:i" }}
                        </span>
                    </div>

                    <div class="wrong-item-body">
                        <div class="wrong-item-question">
                            {{ item.question.text }}
                        </div>

                        <div class="wrong-item-answers">
                            {% for answer in item.question.answers.all %}
                            <div class="wrong-answer {% if item.selected_answer.id == answer.id %}user-selected{% elif answer.is_correct %}correct{% else %}neutral{% endif %}">
                                <span class="wrong-answer-letter">
                                    {% if forloop.counter == 1 %}A{% elif forloop.counter == 2 %}B{% elif forloop.counter == 3 %}C{% else %}D{% endif %}
                                </span>
                                <span>{{ answer.text }}</span>
                                {% if item.selected_answer.id == answer.id %}
                                <span class="wrong-answer-label">Sizning javobingiz</span>
                                {% elif answer.is_correct %}
                                <span class="wrong-answer-label">To'g'ri javob</span>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            {% else %}
            <!-- Empty State -->
            <div class="wrong-empty">
                <div class="wrong-empty-icon">
                    <i class="bi bi-check-circle-fill"></i>
                </div>
                <h3>Zo'r! Xatolar yo'q</h3>
                <p>Siz hali noto'g'ri javob bermadingiz yoki barcha xatolarni to'g'irladingiz</p>
                <a href="{% url 'tests_app:question_bank' %}" class="btn btn-primary">
                    <i class="bi bi-play-fill me-2"></i>Yangi test boshlash
                </a>
            </div>
            {% endif %}
        </main>
    </div>
</div>
{% endblock %}
