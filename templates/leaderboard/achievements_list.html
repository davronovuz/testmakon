{% extends 'base.html' %}
{% load static %}

{% block title %}Yutuqlar - TestMakon{% endblock %}

{% block extra_css %}
{% include 'leaderboard/_sidebar_css.html' %}
<style>
    .ach-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; }
    .ach-header-title { font-size: 1.25rem; font-weight: 700; color: var(--dark); }
    .ach-count-badge { background: var(--primary-glow); color: var(--primary); border-radius: 20px; padding: 0.35rem 0.9rem; font-size: 0.85rem; font-weight: 700; }

    .ach-category { margin-bottom: 2rem; }
    .ach-category-title { font-size: 0.95rem; font-weight: 700; color: var(--dark); margin-bottom: 0.875rem; display: flex; align-items: center; gap: 0.5rem; }
    .ach-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.875rem; }

    .ach-card { background: #fff; border: 1px solid var(--gray-200); border-radius: 14px; padding: 1rem; display: flex; align-items: flex-start; gap: 0.875rem; transition: transform 0.2s; text-decoration: none; color: inherit; }
    .ach-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); color: inherit; }
    .ach-card.earned { border-color: var(--primary); background: linear-gradient(135deg, rgba(139,197,64,0.08) 0%, rgba(139,197,64,0.04) 100%); }
    .ach-card.hidden { opacity: 0.55; }

    .ach-icon-box { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .ach-icon-box.earned { background: var(--gradient-primary); }
    .ach-icon-box.locked { background: var(--gray-200); }
    .ach-icon-box img { width: 28px; height: 28px; object-fit: contain; }

    .ach-name { font-size: 0.88rem; font-weight: 700; color: var(--dark); margin-bottom: 0.2rem; }
    .ach-desc { font-size: 0.78rem; color: var(--gray-500); line-height: 1.4; margin-bottom: 0.5rem; }
    .ach-badges { display: flex; align-items: center; gap: 0.4rem; flex-wrap: wrap; }

    .ach-progress { margin-top: 0.625rem; padding-top: 0.625rem; border-top: 1px solid var(--gray-100); }
    .ach-progress-bar { background: var(--gray-200); border-radius: 10px; height: 5px; overflow: hidden; margin-top: 0.25rem; }
    .ach-progress-fill { background: var(--gradient-primary); height: 100%; border-radius: 10px; }

    @media (max-width: 768px) { .ach-grid { grid-template-columns: 1fr; } }
    @media (max-width: 576px) { .lb-layout { grid-template-columns: 1fr; } }
</style>
{% endblock %}

{% block content %}
<section class="section-sm">
    <div class="container">
        <div class="lb-layout">
            {% include 'leaderboard/_sidebar.html' with active='achievements' %}

            <div class="lb-main">
                <div class="ach-header">
                    <div class="ach-header-title">
                        üèÜ Yutuqlar
                    </div>
                    {% if user.is_authenticated %}
                    <span class="ach-count-badge">{{ earned_ids|length }} ta olgan</span>
                    {% endif %}
                </div>

                {% for category, achievements in by_category.items %}
                <div class="ach-category">
                    <div class="ach-category-title">
                        {% if category == 'Streak' %}<i class="bi bi-fire" style="color:#F97316;"></i>
                        {% elif category == 'Test' %}<i class="bi bi-pencil-square" style="color:var(--primary);"></i>
                        {% elif category == 'Ball' %}<i class="bi bi-star" style="color:var(--accent);"></i>
                        {% elif category == 'Musobaqa' %}<i class="bi bi-trophy" style="color:#8B5CF6;"></i>
                        {% elif category == 'Ijtimoiy' %}<i class="bi bi-people" style="color:#3B82F6;"></i>
                        {% else %}<i class="bi bi-gem" style="color:#EC4899;"></i>{% endif %}
                        {{ category }}
                    </div>

                    <div class="ach-grid">
                        {% for ach in achievements %}
                        <a href="{% url 'leaderboard:achievement_detail' ach.slug %}"
                           class="ach-card {% if ach.id in earned_ids %}earned{% endif %} {% if ach.is_hidden and ach.id not in earned_ids %}hidden{% endif %}">
                            <div class="ach-icon-box {% if ach.id in earned_ids %}earned{% else %}locked{% endif %}">
                                {% if ach.icon %}
                                    <img src="{{ ach.icon.url }}" alt="" style="{% if ach.id not in earned_ids %}filter:grayscale(100%);{% endif %}">
                                {% else %}
                                    <i class="bi bi-award" style="font-size:1.25rem; color:{% if ach.id in earned_ids %}white{% else %}var(--gray-400){% endif %};"></i>
                                {% endif %}
                            </div>
                            <div style="flex:1;min-width:0;">
                                <div class="ach-name">
                                    {% if ach.is_hidden and ach.id not in earned_ids %}???{% else %}{{ ach.name }}{% endif %}
                                    {% if ach.id in earned_ids %}<i class="bi bi-check-circle-fill" style="color:var(--primary);font-size:0.8rem;"></i>{% endif %}
                                </div>
                                <div class="ach-desc">
                                    {% if ach.is_hidden and ach.id not in earned_ids %}Yashirin yutuq{% else %}{{ ach.description|truncatechars:55 }}{% endif %}
                                </div>
                                <div class="ach-badges">
                                    <span class="badge" style="font-size:0.68rem;
                                        {% if ach.rarity == 'common' %}background:var(--gray-200);color:var(--gray-600);
                                        {% elif ach.rarity == 'uncommon' %}background:#D1FAE5;color:#065F46;
                                        {% elif ach.rarity == 'rare' %}background:#DBEAFE;color:#1E40AF;
                                        {% elif ach.rarity == 'epic' %}background:#EDE9FE;color:#6D28D9;
                                        {% else %}background:linear-gradient(135deg,#FEF3C7,#FDE68A);color:#92400E;
                                        {% endif %}">{{ ach.get_rarity_display }}</span>
                                    <span style="font-size:0.75rem;color:var(--primary);">
                                        <i class="bi bi-star-fill" style="font-size:0.65rem;"></i> {{ ach.xp_reward }} XP
                                    </span>
                                </div>
                                {% if ach.id not in earned_ids and not ach.is_hidden %}
                                <div class="ach-progress">
                                    <div style="font-size:0.72rem;color:var(--gray-400);">{{ ach.earn_percentage }}% olgan</div>
                                    <div class="ach-progress-bar">
                                        <div class="ach-progress-fill" style="width:{{ ach.earn_percentage }}%;"></div>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-5" style="color:var(--gray-400);">
                    <i class="bi bi-trophy" style="font-size:3rem;display:block;margin-bottom:0.75rem;"></i>
                    Yutuqlar hali qo'shilmagan
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endblock %}
