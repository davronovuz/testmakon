{% extends 'base.html' %}
{% load static %}

{% block title %}Yutuqlar - TestMakon{% endblock %}

{% block content %}
<!-- Hero Section -->
<section style="background: linear-gradient(135deg, #F8FAFC 0%, #E2E8F0 50%, #F1F5F9 100%); padding: 3rem 0;">
    <div class="container">
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{% url 'core:home' %}">Bosh sahifa</a></li>
                <li class="breadcrumb-item"><a href="{% url 'leaderboard:leaderboard_main' %}">Reyting</a></li>
                <li class="breadcrumb-item active">Yutuqlar</li>
            </ol>
        </nav>
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="mb-3"><span class="text-gradient">Yutuqlar</span> üèÜ</h1>
                <p class="lead mb-0" style="color: var(--gray-500);">
                    Muvaffaqiyatlaringizni nishonlang va maxsus yutuqlarni qo'lga kiriting!
                </p>
            </div>
            {% if user.is_authenticated %}
            <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
                <div class="d-inline-block" style="background: var(--white); border-radius: var(--radius-lg); padding: 1rem 1.5rem; box-shadow: var(--shadow);">
                    <span style="color: var(--gray-500);">Sizning yutuqlaringiz:</span>
                    <span class="fw-bold ms-2" style="color: var(--primary); font-size: 1.25rem;">{{ earned_ids|length }}</span>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</section>

<section class="section-sm">
    <div class="container">
        {% for category, achievements in by_category.items %}
        <div class="mb-5">
            <h4 class="fw-bold mb-4">
                {% if category == 'Streak' %}
                    <i class="bi bi-fire me-2" style="color: #F97316;"></i>
                {% elif category == 'Test' %}
                    <i class="bi bi-pencil-square me-2" style="color: var(--primary);"></i>
                {% elif category == 'Ball' %}
                    <i class="bi bi-star me-2" style="color: var(--accent);"></i>
                {% elif category == 'Musobaqa' %}
                    <i class="bi bi-trophy me-2" style="color: #8B5CF6;"></i>
                {% elif category == 'Ijtimoiy' %}
                    <i class="bi bi-people me-2" style="color: #3B82F6;"></i>
                {% else %}
                    <i class="bi bi-gem me-2" style="color: #EC4899;"></i>
                {% endif %}
                {{ category }}
            </h4>

            <div class="row g-3">
                {% for achievement in achievements %}
                <div class="col-sm-6 col-lg-4 col-xl-3">
                    <a href="{% url 'leaderboard:achievement_detail' achievement.slug %}" class="text-decoration-none">
                        <div class="card h-100 p-3 {% if achievement.id in earned_ids %}card-glow{% endif %}"
                             style="{% if achievement.id in earned_ids %}border: 2px solid var(--primary); background: linear-gradient(135deg, rgba(139, 197, 64, 0.1) 0%, rgba(139, 197, 64, 0.05) 100%);{% else %}{% if achievement.is_hidden and achievement.id not in earned_ids %}opacity: 0.6;{% endif %}{% endif %}">

                            <div class="d-flex align-items-start gap-3">
                                <!-- Icon -->
                                <div style="width: 56px; height: 56px; background: {% if achievement.id in earned_ids %}var(--gradient-primary){% else %}var(--gray-200){% endif %}; border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                    {% if achievement.icon %}
                                        <img src="{{ achievement.icon.url }}" alt="" style="width: 32px; height: 32px; object-fit: contain; {% if achievement.id not in earned_ids %}filter: grayscale(100%);{% endif %}">
                                    {% else %}
                                        <i class="bi bi-award" style="font-size: 1.5rem; color: {% if achievement.id in earned_ids %}white{% else %}var(--gray-400){% endif %};"></i>
                                    {% endif %}
                                </div>

                                <!-- Content -->
                                <div class="flex-grow-1">
                                    <div class="d-flex align-items-center gap-2 mb-1">
                                        <h6 class="fw-bold mb-0" style="color: var(--dark); font-size: 0.95rem;">
                                            {% if achievement.is_hidden and achievement.id not in earned_ids %}
                                                ???
                                            {% else %}
                                                {{ achievement.name }}
                                            {% endif %}
                                        </h6>
                                        {% if achievement.id in earned_ids %}
                                        <i class="bi bi-check-circle-fill" style="color: var(--primary);"></i>
                                        {% endif %}
                                    </div>

                                    <p class="small mb-2" style="color: var(--gray-500); line-height: 1.4;">
                                        {% if achievement.is_hidden and achievement.id not in earned_ids %}
                                            Yashirin yutuq
                                        {% else %}
                                            {{ achievement.description|truncatechars:50 }}
                                        {% endif %}
                                    </p>

                                    <!-- Rarity & XP -->
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="badge" style="font-size: 0.7rem;
                                            {% if achievement.rarity == 'common' %}background: var(--gray-200); color: var(--gray-600);
                                            {% elif achievement.rarity == 'uncommon' %}background: #D1FAE5; color: #065F46;
                                            {% elif achievement.rarity == 'rare' %}background: #DBEAFE; color: #1E40AF;
                                            {% elif achievement.rarity == 'epic' %}background: #EDE9FE; color: #6D28D9;
                                            {% else %}background: linear-gradient(135deg, #FEF3C7, #FDE68A); color: #92400E;
                                            {% endif %}">
                                            {{ achievement.get_rarity_display }}
                                        </span>
                                        <span class="small" style="color: var(--primary);">
                                            <i class="bi bi-star-fill" style="font-size: 0.7rem;"></i> {{ achievement.xp_reward }} XP
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- Progress indicator -->
                            {% if achievement.id not in earned_ids and not achievement.is_hidden %}
                            <div class="mt-3 pt-3" style="border-top: 1px solid var(--gray-200);">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <small style="color: var(--gray-500);">{{ achievement.earn_percentage }}% olgan</small>
                                </div>
                                <div style="background: var(--gray-200); border-radius: 10px; height: 6px; overflow: hidden;">
                                    <div style="background: var(--gradient-primary); height: 100%; width: {{ achievement.earn_percentage }}%; border-radius: 10px;"></div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% empty %}
        <div class="text-center py-5">
            <i class="bi bi-trophy" style="font-size: 4rem; color: var(--gray-300);"></i>
            <h4 class="mt-3">Yutuqlar hali qo'shilmagan</h4>
            <p style="color: var(--gray-500);">Tez orada yangi yutuqlar paydo bo'ladi!</p>
        </div>
        {% endfor %}
    </div>
</section>

<!-- Motivation Section -->
<section class="section-sm" style="background: var(--dark);">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h3 class="text-white mb-3">Barcha yutuqlarni oching! üéØ</h3>
                <p class="text-white mb-0" style="opacity: 0.8;">
                    Test yeching, streak saqlab turing, musobaqalarda qatnashing va maxsus yutuqlarni qo'lga kiriting.
                    Har bir yutuq sizga qo'shimcha XP beradi!
                </p>
            </div>
            <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
                <a href="{% url 'tests_app:tests_list' %}" class="btn btn-primary btn-lg">
                    Test boshlash <i class="bi bi-arrow-right ms-2"></i>
                </a>
            </div>
        </div>
    </div>
</section>
{% endblock %}