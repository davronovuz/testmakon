{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}To'lov | TestMakon{% endblock %}

{% block extra_css %}
<style>
    .co-page { padding: 2.5rem 0 4rem; background: var(--gray-50); }

    .co-wrap { max-width: 480px; margin: 0 auto; }

    .co-header { margin-bottom: 1.5rem; }
    .co-header h1 { font-size: 1.4rem; font-weight: 900; color: var(--dark); margin-bottom: 0.25rem; }
    .co-header p { font-size: 0.88rem; color: var(--gray-500); }

    .co-card {
        background: #fff; border: 1px solid var(--gray-200);
        border-radius: 18px; padding: 1.5rem; margin-bottom: 1rem;
    }

    .co-plan-row {
        display: flex; justify-content: space-between; align-items: center;
        padding-bottom: 1rem; margin-bottom: 1rem;
        border-bottom: 1px solid var(--gray-100);
    }
    .co-plan-name { font-size: 1rem; font-weight: 800; color: var(--dark); }
    .co-plan-dur { font-size: 0.78rem; color: var(--gray-500); margin-top: 2px; }
    .co-plan-price { font-size: 1.4rem; font-weight: 900; color: var(--dark); }
    .co-plan-currency { font-size: 0.82rem; color: var(--gray-400); }

    /* Promo */
    .co-promo-label { font-size: 0.75rem; font-weight: 700; color: var(--gray-500); text-transform: uppercase; letter-spacing: 0.4px; margin-bottom: 0.5rem; }
    .co-promo-row { display: flex; gap: 8px; }
    .co-promo-input {
        flex: 1; border: 1px solid var(--gray-200); border-radius: 10px;
        padding: 0.6rem 1rem; font-size: 0.88rem; outline: none;
        background: var(--gray-50); color: var(--dark);
    }
    .co-promo-input:focus { border-color: var(--primary); background: #fff; }
    .co-promo-btn {
        background: var(--dark); color: #fff; border: none;
        border-radius: 10px; padding: 0.6rem 1.2rem;
        font-size: 0.85rem; font-weight: 700; cursor: pointer;
    }
    .co-promo-success { font-size: 0.78rem; color: #059669; margin-top: 6px; }

    /* Total */
    .co-total-card {
        background: var(--gray-50); border-radius: 12px;
        padding: 1rem 1.25rem; margin-top: 1rem;
    }
    .co-total-row { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--gray-500); margin-bottom: 6px; }
    .co-total-row.discount { color: #059669; }
    .co-total-final {
        display: flex; justify-content: space-between;
        font-size: 1.05rem; font-weight: 900; color: var(--dark);
        border-top: 1px solid var(--gray-200); padding-top: 10px; margin-top: 6px;
    }

    /* Pay button */
    .co-pay-btn {
        display: block; width: 100%; padding: 0.9rem;
        background: var(--gradient-primary); color: #fff;
        border: none; border-radius: 14px; font-size: 1rem; font-weight: 800;
        text-align: center; text-decoration: none;
        cursor: pointer; transition: all 0.2s; margin-top: 1rem;
    }
    .co-pay-btn:hover { color: #fff; box-shadow: var(--shadow-primary); }

    .co-secure { text-align: center; font-size: 0.75rem; color: var(--gray-400); margin-top: 0.75rem; }

    @media(max-width: 575px) {
        .co-page { padding: 1.5rem 0 3rem; }
        .co-card { padding: 1.25rem; }
        .co-plan-price { font-size: 1.2rem; }
        .co-promo-row { flex-direction: column; }
        .co-promo-btn { width: 100%; }
    }
</style>
{% endblock %}

{% block content %}
<div class="co-page">
    <div class="container">
        <div class="co-wrap">

            <div class="co-header">
                <h1>To'lovni tasdiqlash</h1>
                <p>Karta orqali to'lang va chek rasmini yuklang</p>
            </div>

            <div class="co-card">
                <!-- Plan info -->
                <div class="co-plan-row">
                    <div>
                        <div class="co-plan-name">{{ plan.name }}</div>
                        <div class="co-plan-dur">{{ plan.duration_days }} kunlik obuna</div>
                    </div>
                    <div class="text-end">
                        <span class="co-plan-price">{{ plan.price|intcomma }}</span>
                        <span class="co-plan-currency"> so'm</span>
                    </div>
                </div>

                <!-- Promo code -->
                <div class="co-promo-label">Promo kod (ixtiyoriy)</div>
                <form method="post">
                    {% csrf_token %}
                    <div class="co-promo-row">
                        <input type="text" name="promo_code" class="co-promo-input"
                               placeholder="Kodni kiriting"
                               value="{{ promo_code.code|default:'' }}">
                        <button type="submit" class="co-promo-btn">Qo'llash</button>
                    </div>
                    {% if promo_code %}
                    <div class="co-promo-success"><i class="bi bi-check-circle-fill me-1"></i>Chegirma qo'llandi!</div>
                    {% endif %}
                </form>

                <!-- Total -->
                <div class="co-total-card">
                    <div class="co-total-row">
                        <span>Asl narx</span>
                        <span>{{ plan.price|intcomma }} so'm</span>
                    </div>
                    {% if discount > 0 %}
                    <div class="co-total-row discount">
                        <span>Chegirma</span>
                        <span>–{{ discount|intcomma }} so'm</span>
                    </div>
                    {% endif %}
                    <div class="co-total-final">
                        <span>Jami</span>
                        <span>{{ final_price|intcomma }} so'm</span>
                    </div>
                </div>
            </div>

            <!-- Pay button -->
            <a href="{% url 'subscriptions:manual_payment' slug=plan.slug %}{% if promo_code %}?promo_code={{ promo_code.code }}{% endif %}"
               class="co-pay-btn">
                <i class="bi bi-bank me-2"></i>Karta orqali to'lash →
            </a>

            <div class="co-secure">
                <i class="bi bi-lock-fill me-1"></i>Barcha to'lovlar xavfsiz
            </div>

        </div>
    </div>
</div>
{% endblock %}
