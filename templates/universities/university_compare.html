{% extends 'base.html' %}
{% load static %}

{% block title %}Universitetlarni solishtirish | TestMakon{% endblock %}

{% block extra_css %}
<style>
    /* ========== PAGE HEADER ========== */
    .uc-header {
        background: var(--gradient-dark);
        padding: 2.5rem 0;
        color: white;
    }

    .uc-header h1 {
        font-size: 1.75rem;
        color: white;
        margin-bottom: 0.5rem;
    }

    .uc-header p {
        font-size: 0.95rem;
        color: rgba(255,255,255,0.8);
        margin: 0;
    }

    /* ========== CONTENT ========== */
    .uc-content {
        padding: 2rem 0 4rem;
        background: var(--gray-50);
        min-height: 70vh;
    }

    /* ========== SELECTOR CARDS ========== */
    .uc-selectors {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 1.5rem;
        margin-bottom: 2rem;
        align-items: center;
    }

    @media (max-width: 992px) {
        .uc-selectors {
            grid-template-columns: 1fr;
        }
    }

    .uc-selector-card {
        background: var(--white);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow);
        padding: 2rem;
        text-align: center;
        min-height: 280px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
        cursor: pointer;
        border: 2px solid transparent;
        position: relative;
    }

    .uc-selector-card:hover {
        border-color: var(--primary);
    }

    .uc-selector-card.selected {
        border-color: var(--primary);
    }

    .uc-selector-card.empty {
        border: 2px dashed var(--gray-300);
        background: var(--gray-50);
    }

    .uc-selector-number {
        position: absolute;
        top: 1rem;
        left: 1rem;
        width: 28px;
        height: 28px;
        background: var(--primary);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.85rem;
        font-weight: 700;
    }

    .uc-selector-card.empty .uc-selector-number {
        background: var(--gray-300);
    }

    .uc-selector-logo {
        width: 80px;
        height: 80px;
        border-radius: var(--radius-lg);
        background: var(--gray-100);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        overflow: hidden;
    }

    .uc-selector-logo img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        padding: 0.5rem;
    }

    .uc-selector-logo-text {
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--primary);
    }

    .uc-selector-logo-icon {
        font-size: 2rem;
        color: var(--gray-400);
    }

    .uc-selector-name {
        font-size: 1rem;
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 0.5rem;
    }

    .uc-selector-type {
        font-size: 0.8rem;
        font-weight: 600;
        padding: 0.25rem 0.6rem;
        border-radius: 4px;
        display: inline-block;
    }

    .uc-selector-type.state {
        background: #DBEAFE;
        color: #1D4ED8;
    }

    .uc-selector-type.private {
        background: #FEE2E2;
        color: #DC2626;
    }

    .uc-selector-btn {
        padding: 0.75rem 1.5rem;
        background: var(--primary-glow);
        color: var(--primary-dark);
        border: none;
        border-radius: var(--radius);
        font-size: 0.9rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 1rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    .uc-selector-btn:hover {
        background: var(--primary);
        color: white;
    }

    .uc-selector-remove {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: 28px;
        height: 28px;
        background: #FEE2E2;
        color: #DC2626;
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    .uc-selector-remove:hover {
        background: #DC2626;
        color: white;
    }

    /* VS Circle */
    .uc-vs {
        width: 56px;
        height: 56px;
        background: var(--gradient-primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        font-weight: 800;
        color: white;
        box-shadow: var(--shadow-primary);
    }

    @media (max-width: 992px) {
        .uc-vs {
            margin: 0 auto;
        }
    }

    /* ========== COMPARISON TABLE ========== */
    .uc-table-card {
        background: var(--white);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow);
        overflow: hidden;
    }

    .uc-table-header {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--gray-100);
        font-size: 1rem;
        font-weight: 700;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .uc-table-header i {
        color: var(--primary);
    }

    .uc-table {
        width: 100%;
    }

    .uc-table-row {
        display: grid;
        grid-template-columns: 200px 1fr 1fr;
        border-bottom: 1px solid var(--gray-100);
    }

    @media (max-width: 768px) {
        .uc-table-row {
            grid-template-columns: 1fr;
        }
    }

    .uc-table-row:last-child {
        border-bottom: none;
    }

    .uc-table-label {
        padding: 1rem 1.5rem;
        background: var(--gray-50);
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--gray-600);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .uc-table-label i {
        color: var(--primary);
        font-size: 1rem;
    }

    @media (max-width: 768px) {
        .uc-table-label {
            background: var(--primary-glow);
            color: var(--primary-dark);
        }
    }

    .uc-table-value {
        padding: 1rem 1.5rem;
        font-size: 0.95rem;
        color: var(--dark-600);
        display: flex;
        align-items: center;
        border-left: 1px solid var(--gray-100);
    }

    @media (max-width: 768px) {
        .uc-table-value {
            border-left: none;
            padding-left: 1.5rem;
        }

        .uc-table-value::before {
            content: attr(data-label);
            font-weight: 600;
            color: var(--gray-500);
            margin-right: 0.5rem;
        }
    }

    .uc-table-value.highlight {
        background: #D1FAE5;
        color: #059669;
        font-weight: 700;
    }

    .uc-table-value strong {
        color: var(--dark);
    }

    /* Winner badge */
    .uc-winner-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.15rem 0.5rem;
        background: #D1FAE5;
        color: #059669;
        font-size: 0.7rem;
        font-weight: 700;
        border-radius: 4px;
        margin-left: 0.5rem;
    }

    /* ========== NO SELECTION ========== */
    .uc-no-selection {
        text-align: center;
        padding: 4rem 2rem;
        background: var(--white);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow);
    }

    .uc-no-selection-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.4;
    }

    .uc-no-selection h4 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }

    .uc-no-selection p {
        color: var(--gray-500);
        margin: 0;
    }

    /* ========== SEARCH MODAL ========== */
    .uc-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.6);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s;
    }

    .uc-modal-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .uc-modal {
        background: var(--white);
        border-radius: var(--radius-xl);
        width: 90%;
        max-width: 500px;
        max-height: 80vh;
        overflow: hidden;
        transform: scale(0.9);
        transition: all 0.3s;
    }

    .uc-modal-overlay.active .uc-modal {
        transform: scale(1);
    }

    .uc-modal-header {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--gray-100);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .uc-modal-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--dark);
    }

    .uc-modal-close {
        width: 36px;
        height: 36px;
        background: var(--gray-100);
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .uc-modal-close:hover {
        background: var(--gray-200);
    }

    .uc-modal-search {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--gray-100);
    }

    .uc-modal-search input {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid var(--gray-200);
        border-radius: var(--radius);
        font-size: 0.95rem;
    }

    .uc-modal-search input:focus {
        outline: none;
        border-color: var(--primary);
    }

    .uc-modal-list {
        max-height: 400px;
        overflow-y: auto;
    }

    .uc-modal-item {
        padding: 1rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        cursor: pointer;
        transition: all 0.2s;
        border-bottom: 1px solid var(--gray-100);
    }

    .uc-modal-item:hover {
        background: var(--gray-50);
    }

    .uc-modal-item:last-child {
        border-bottom: none;
    }

    .uc-modal-item-logo {
        width: 44px;
        height: 44px;
        background: var(--gray-100);
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        overflow: hidden;
    }

    .uc-modal-item-logo img {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }

    .uc-modal-item-logo span {
        font-weight: 700;
        color: var(--primary);
    }

    .uc-modal-item-info {
        flex: 1;
    }

    .uc-modal-item-name {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--dark);
    }

    .uc-modal-item-region {
        font-size: 0.8rem;
        color: var(--gray-500);
    }
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="uc-header">
    <div class="container">
        <h1>üìä Universitetlarni solishtirish</h1>
        <p>Ikki universitetni tanlang va farqlarini ko'ring</p>
    </div>
</div>

<!-- Content -->
<div class="uc-content">
    <div class="container">
        <!-- Selectors -->
        <div class="uc-selectors">
            <!-- University 1 -->
            <div class="uc-selector-card {% if uni1 %}selected{% else %}empty{% endif %}" id="selector1" onclick="openModal(1)">
                <span class="uc-selector-number">1</span>

                {% if uni1 %}
                <button class="uc-selector-remove" onclick="event.stopPropagation(); removeUni(1);">
                    <i class="bi bi-x"></i>
                </button>
                <div class="uc-selector-logo">
                    {% if uni1.logo %}
                    <img src="{{ uni1.logo.url }}" alt="">
                    {% else %}
                    <span class="uc-selector-logo-text">{{ uni1.name|slice:":2"|upper }}</span>
                    {% endif %}
                </div>
                <div class="uc-selector-name">{{ uni1.name }}</div>
                <span class="uc-selector-type {% if uni1.university_type == 'state' %}state{% else %}private{% endif %}">
                    {% if uni1.university_type == 'state' %}Davlat{% else %}Xususiy{% endif %}
                </span>
                {% else %}
                <div class="uc-selector-logo">
                    <i class="bi bi-plus-lg uc-selector-logo-icon"></i>
                </div>
                <div class="uc-selector-name" style="color:var(--gray-500);">Universitet tanlang</div>
                <button class="uc-selector-btn">
                    <i class="bi bi-search"></i>
                    Tanlash
                </button>
                {% endif %}
            </div>

            <!-- VS -->
            <div class="uc-vs">VS</div>

            <!-- University 2 -->
            <div class="uc-selector-card {% if uni2 %}selected{% else %}empty{% endif %}" id="selector2" onclick="openModal(2)">
                <span class="uc-selector-number">2</span>

                {% if uni2 %}
                <button class="uc-selector-remove" onclick="event.stopPropagation(); removeUni(2);">
                    <i class="bi bi-x"></i>
                </button>
                <div class="uc-selector-logo">
                    {% if uni2.logo %}
                    <img src="{{ uni2.logo.url }}" alt="">
                    {% else %}
                    <span class="uc-selector-logo-text">{{ uni2.name|slice:":2"|upper }}</span>
                    {% endif %}
                </div>
                <div class="uc-selector-name">{{ uni2.name }}</div>
                <span class="uc-selector-type {% if uni2.university_type == 'state' %}state{% else %}private{% endif %}">
                    {% if uni2.university_type == 'state' %}Davlat{% else %}Xususiy{% endif %}
                </span>
                {% else %}
                <div class="uc-selector-logo">
                    <i class="bi bi-plus-lg uc-selector-logo-icon"></i>
                </div>
                <div class="uc-selector-name" style="color:var(--gray-500);">Universitet tanlang</div>
                <button class="uc-selector-btn">
                    <i class="bi bi-search"></i>
                    Tanlash
                </button>
                {% endif %}
            </div>
        </div>

        <!-- Comparison Table -->
        {% if uni1 and uni2 %}
        <div class="uc-table-card">
            <div class="uc-table-header">
                <i class="bi bi-bar-chart"></i>
                Taqqoslash jadvali
            </div>

            <div class="uc-table">
                <!-- Type -->
                <div class="uc-table-row">
                    <div class="uc-table-label">
                        <i class="bi bi-building"></i>
                        Turi
                    </div>
                    <div class="uc-table-value">
                        {% if uni1.university_type == 'state' %}Davlat{% else %}Xususiy{% endif %}
                    </div>
                    <div class="uc-table-value">
                        {% if uni2.university_type == 'state' %}Davlat{% else %}Xususiy{% endif %}
                    </div>
                </div>

                <!-- Region -->
                <div class="uc-table-row">
                    <div class="uc-table-label">
                        <i class="bi bi-geo-alt"></i>
                        Hudud
                    </div>
                    <div class="uc-table-value">{{ uni1.region|default:"Toshkent" }}</div>
                    <div class="uc-table-value">{{ uni2.region|default:"Toshkent" }}</div>
                </div>

                <!-- Directions -->
                <div class="uc-table-row">
                    <div class="uc-table-label">
                        <i class="bi bi-mortarboard"></i>
                        Yo'nalishlar
                    </div>
                    <div class="uc-table-value {% if uni1.directions_count > uni2.directions_count %}highlight{% endif %}">
                        <strong>{{ uni1.directions_count|default:"45" }}</strong>
                        {% if uni1.directions_count > uni2.directions_count %}
                        <span class="uc-winner-badge"><i class="bi bi-trophy-fill"></i></span>
                        {% endif %}
                    </div>
                    <div class="uc-table-value {% if uni2.directions_count > uni1.directions_count %}highlight{% endif %}">
                        <strong>{{ uni2.directions_count|default:"38" }}</strong>
                        {% if uni2.directions_count > uni1.directions_count %}
                        <span class="uc-winner-badge"><i class="bi bi-trophy-fill"></i></span>
                        {% endif %}
                    </div>
                </div>

                <!-- Grant Places -->
                <div class="uc-table-row">
                    <div class="uc-table-label">
                        <i class="bi bi-trophy"></i>
                        Grant o'rinlari
                    </div>
                    <div class="uc-table-value {% if uni1.grant_places > uni2.grant_places %}highlight{% endif %}">
                        <strong>{{ uni1.grant_places|default:"1200" }}</strong>
                        {% if uni1.grant_places > uni2.grant_places %}
                        <span class="uc-winner-badge"><i class="bi bi-trophy-fill"></i></span>
                        {% endif %}
                    </div>
                    <div class="uc-table-value {% if uni2.grant_places > uni1.grant_places %}highlight{% endif %}">
                        <strong>{{ uni2.grant_places|default:"800" }}</strong>
                        {% if uni2.grant_places > uni1.grant_places %}
                        <span class="uc-winner-badge"><i class="bi bi-trophy-fill"></i></span>
                        {% endif %}
                    </div>
                </div>

                <!-- Average Score -->
                <div class="uc-table-row">
                    <div class="uc-table-label">
                        <i class="bi bi-graph-up"></i>
                        O'rtacha ball
                    </div>
                    <div class="uc-table-value {% if uni1.avg_passing_score < uni2.avg_passing_score %}highlight{% endif %}">
                        <strong>{{ uni1.avg_passing_score|default:"168" }}</strong>
                        {% if uni1.avg_passing_score < uni2.avg_passing_score %}
                        <span class="uc-winner-badge"><i class="bi bi-trophy-fill"></i> Osonroq</span>
                        {% endif %}
                    </div>
                    <div class="uc-table-value {% if uni2.avg_passing_score < uni1.avg_passing_score %}highlight{% endif %}">
                        <strong>{{ uni2.avg_passing_score|default:"175" }}</strong>
                        {% if uni2.avg_passing_score < uni1.avg_passing_score %}
                        <span class="uc-winner-badge"><i class="bi bi-trophy-fill"></i> Osonroq</span>
                        {% endif %}
                    </div>
                </div>

                <!-- Min Contract -->
                <div class="uc-table-row">
                    <div class="uc-table-label">
                        <i class="bi bi-cash-coin"></i>
                        Min kontrakt
                    </div>
                    <div class="uc-table-value {% if uni1.min_contract_price < uni2.min_contract_price %}highlight{% endif %}">
                        <strong>{{ uni1.min_contract_price|default:"14 000 000" }} UZS</strong>
                        {% if uni1.min_contract_price < uni2.min_contract_price %}
                        <span class="uc-winner-badge"><i class="bi bi-trophy-fill"></i> Arzonroq</span>
                        {% endif %}
                    </div>
                    <div class="uc-table-value {% if uni2.min_contract_price < uni1.min_contract_price %}highlight{% endif %}">
                        <strong>{{ uni2.min_contract_price|default:"18 000 000" }} UZS</strong>
                        {% if uni2.min_contract_price < uni1.min_contract_price %}
                        <span class="uc-winner-badge"><i class="bi bi-trophy-fill"></i> Arzonroq</span>
                        {% endif %}
                    </div>
                </div>

                <!-- Rating -->
                <div class="uc-table-row">
                    <div class="uc-table-label">
                        <i class="bi bi-star"></i>
                        Reyting
                    </div>
                    <div class="uc-table-value {% if uni1.rating > uni2.rating %}highlight{% endif %}">
                        <strong>{{ uni1.rating|default:"4.5" }} ‚≠ê</strong>
                        {% if uni1.rating > uni2.rating %}
                        <span class="uc-winner-badge"><i class="bi bi-trophy-fill"></i></span>
                        {% endif %}
                    </div>
                    <div class="uc-table-value {% if uni2.rating > uni1.rating %}highlight{% endif %}">
                        <strong>{{ uni2.rating|default:"4.2" }} ‚≠ê</strong>
                        {% if uni2.rating > uni1.rating %}
                        <span class="uc-winner-badge"><i class="bi bi-trophy-fill"></i></span>
                        {% endif %}
                    </div>
                </div>

                <!-- Students -->
                <div class="uc-table-row">
                    <div class="uc-table-label">
                        <i class="bi bi-people"></i>
                        Talabalar
                    </div>
                    <div class="uc-table-value">
                        <strong>{{ uni1.students_count|default:"5000" }}+</strong>
                    </div>
                    <div class="uc-table-value">
                        <strong>{{ uni2.students_count|default:"3500" }}+</strong>
                    </div>
                </div>

                <!-- Founded -->
                <div class="uc-table-row">
                    <div class="uc-table-label">
                        <i class="bi bi-calendar"></i>
                        Tashkil etilgan
                    </div>
                    <div class="uc-table-value">{{ uni1.founded_year|default:"1920" }}-yil</div>
                    <div class="uc-table-value">{{ uni2.founded_year|default:"1995" }}-yil</div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="uc-no-selection">
            <div class="uc-no-selection-icon">üìä</div>
            <h4>Ikkita universitet tanlang</h4>
            <p>Solishtirish uchun yuqoridagi kartalarni bosing</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Search Modal -->
<div class="uc-modal-overlay" id="searchModal">
    <div class="uc-modal">
        <div class="uc-modal-header">
            <span class="uc-modal-title">Universitet tanlang</span>
            <button class="uc-modal-close" onclick="closeModal()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>

        <div class="uc-modal-search">
            <input type="text" placeholder="Universitet qidirish..." id="modalSearch">
        </div>

        <div class="uc-modal-list" id="modalList">
            {% for uni in universities %}
            <div class="uc-modal-item" onclick="selectUni('{{ uni.slug }}')">
                <div class="uc-modal-item-logo">
                    {% if uni.logo %}
                    <img src="{{ uni.logo.url }}" alt="">
                    {% else %}
                    <span>{{ uni.name|slice:":2"|upper }}</span>
                    {% endif %}
                </div>
                <div class="uc-modal-item-info">
                    <div class="uc-modal-item-name">{{ uni.name }}</div>
                    <div class="uc-modal-item-region">{{ uni.region|default:"Toshkent" }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let currentSelector = 1;
const modal = document.getElementById('searchModal');
const modalSearch = document.getElementById('modalSearch');

function openModal(num) {
    currentSelector = num;
    modal.classList.add('active');
    modalSearch.focus();
}

function closeModal() {
    modal.classList.remove('active');
}

function selectUni(slug) {
    const url = new URL(window.location.href);
    url.searchParams.set('uni' + currentSelector, slug);
    window.location.href = url.toString();
}

function removeUni(num) {
    const url = new URL(window.location.href);
    url.searchParams.delete('uni' + num);
    window.location.href = url.toString();
}

// Search filter
modalSearch.addEventListener('input', function() {
    const query = this.value.toLowerCase();
    document.querySelectorAll('.uc-modal-item').forEach(item => {
        const name = item.querySelector('.uc-modal-item-name').textContent.toLowerCase();
        item.style.display = name.includes(query) ? 'flex' : 'none';
    });
});

// Close modal on overlay click
modal.addEventListener('click', function(e) {
    if (e.target === modal) {
        closeModal();
    }
});
</script>
{% endblock %}