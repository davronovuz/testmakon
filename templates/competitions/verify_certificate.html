{% extends 'base.html' %}
{% load static %}

{% block title %}Sertifikat tekshirish | TestMakon{% endblock %}

{% block extra_css %}
<style>
    .vc-page {
        min-height: 70vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem 1rem;
    }

    .vc-card {
        max-width: 520px;
        width: 100%;
    }

    /* ========== SEARCH FORM ========== */
    .vc-search {
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: 20px;
        padding: 2rem;
        text-align: center;
        margin-bottom: 1.5rem;
    }

    .vc-search-icon {
        width: 56px;
        height: 56px;
        background: rgba(139,197,64,0.1);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        margin: 0 auto 1rem;
    }

    .vc-search h2 {
        font-size: 1.25rem;
        font-weight: 900;
        color: var(--dark);
        margin: 0 0 0.35rem;
    }

    .vc-search p {
        font-size: 0.88rem;
        color: var(--gray-500);
        margin: 0 0 1.25rem;
    }

    .vc-form {
        display: flex;
        gap: 0.65rem;
    }

    .vc-input {
        flex: 1;
        padding: 0.8rem 1rem;
        border: 2px solid var(--gray-200);
        border-radius: 12px;
        font-size: 0.95rem;
        font-weight: 600;
        font-family: monospace;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        color: var(--dark);
        transition: border-color 0.2s;
        outline: none;
    }

    .vc-input:focus { border-color: var(--primary); }
    .vc-input::placeholder { letter-spacing: 0; text-transform: none; font-family: inherit; }

    .vc-form-btn {
        padding: 0.8rem 1.25rem;
        background: var(--gradient-primary);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 0.92rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
    }

    .vc-form-btn:hover { box-shadow: 0 4px 14px -3px rgba(139,197,64,0.4); }

    /* ========== RESULT: FOUND ========== */
    .vc-result {
        background: var(--white);
        border: 2px solid #10B981;
        border-radius: 20px;
        overflow: hidden;
    }

    .vc-result-top {
        background: linear-gradient(135deg, #10B981, #059669);
        padding: 1.5rem 2rem;
        text-align: center;
        color: white;
    }

    .vc-result-icon { font-size: 2.5rem; margin-bottom: 0.5rem; }

    .vc-result-top h3 {
        font-size: 1.15rem;
        font-weight: 800;
        color: white;
        margin: 0 0 0.15rem;
    }

    .vc-result-top p {
        font-size: 0.85rem;
        color: rgba(255,255,255,0.85);
        margin: 0;
    }

    .vc-result-body { padding: 1.5rem 2rem; }

    /* Certificate visual */
    .vc-cert-visual {
        border: 2px dashed var(--gray-200);
        border-radius: 14px;
        padding: 1.5rem;
        text-align: center;
        margin-bottom: 1.25rem;
        background: var(--gray-50);
    }

    .vc-cert-medal { font-size: 2.5rem; margin-bottom: 0.5rem; }

    .vc-cert-type {
        font-size: 1rem;
        font-weight: 800;
        color: var(--dark);
        margin-bottom: 0.25rem;
    }

    .vc-cert-owner {
        font-size: 1.15rem;
        font-weight: 900;
        color: var(--primary);
        margin-bottom: 0.15rem;
    }

    .vc-cert-comp {
        font-size: 0.88rem;
        color: var(--gray-500);
    }

    /* Details list */
    .vc-details {
        list-style: none;
        padding: 0;
        margin: 0 0 1.25rem;
    }

    .vc-details li {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.7rem 0;
        font-size: 0.9rem;
    }

    .vc-details li + li { border-top: 1px solid var(--gray-100); }
    .vc-details li span:first-child { color: var(--gray-500); font-weight: 600; }
    .vc-details li span:last-child { color: var(--dark); font-weight: 700; }

    /* Code display */
    .vc-code-display {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.75rem;
        background: #F0FFF4;
        border: 1px solid #C6F6D5;
        border-radius: 10px;
        font-family: monospace;
        font-size: 1rem;
        font-weight: 800;
        color: #059669;
        letter-spacing: 2px;
    }

    .vc-code-display i { letter-spacing: 0; }

    /* ========== RESULT: NOT FOUND ========== */
    .vc-not-found {
        background: var(--white);
        border: 2px solid #EF4444;
        border-radius: 20px;
        padding: 2rem;
        text-align: center;
    }

    .vc-not-found-icon { font-size: 2.5rem; margin-bottom: 0.75rem; }

    .vc-not-found h3 {
        font-size: 1.15rem;
        font-weight: 800;
        color: #DC2626;
        margin: 0 0 0.35rem;
    }

    .vc-not-found p {
        font-size: 0.9rem;
        color: var(--gray-500);
        margin: 0;
    }

    @media (max-width: 480px) {
        .vc-form { flex-direction: column; }
        .vc-result-body { padding: 1.25rem; }
    }
</style>
{% endblock %}

{% block content %}
<div class="vc-page">
    <div class="vc-card">

        <!-- Search Form -->
        <div class="vc-search">
            <div class="vc-search-icon">üîç</div>
            <h2>Sertifikat tekshirish</h2>
            <p>Sertifikat tasdiqlash kodini kiriting</p>
            <form method="get" class="vc-form">
                <input type="text"
                       name="code"
                       class="vc-input"
                       placeholder="Kodni kiriting..."
                       value="{{ code|default:'' }}"
                       required
                       maxlength="20"
                       autocomplete="off">
                <button type="submit" class="vc-form-btn">
                    <i class="bi bi-search"></i> Tekshirish
                </button>
            </form>
        </div>

        {% if code %}
            {% if certificate %}
            <!-- FOUND -->
            <div class="vc-result">
                <div class="vc-result-top">
                    <div class="vc-result-icon">‚úÖ</div>
                    <h3>Sertifikat tasdiqlandi!</h3>
                    <p>Ushbu sertifikat haqiqiy va TestMakon tomonidan berilgan</p>
                </div>
                <div class="vc-result-body">

                    <div class="vc-cert-visual">
                        <div class="vc-cert-medal">
                            {% if certificate.certificate_type == 'gold' %}ü•á
                            {% elif certificate.certificate_type == 'silver' %}ü•à
                            {% elif certificate.certificate_type == 'bronze' %}ü•â
                            {% else %}üìú
                            {% endif %}
                        </div>
                        <div class="vc-cert-type">
                            {% if certificate.certificate_type == 'gold' %}Oltin sertifikat
                            {% elif certificate.certificate_type == 'silver' %}Kumush sertifikat
                            {% elif certificate.certificate_type == 'bronze' %}Bronza sertifikat
                            {% else %}Ishtirok sertifikati
                            {% endif %}
                        </div>
                        <div class="vc-cert-owner">{{ certificate.user.first_name }} {{ certificate.user.last_name|default:"" }}</div>
                        <div class="vc-cert-comp">{{ certificate.competition.title }}</div>
                    </div>

                    <ul class="vc-details">
                        <li>
                            <span>Egasi</span>
                            <span>{{ certificate.user.first_name }} {{ certificate.user.last_name|default:"" }}</span>
                        </li>
                        <li>
                            <span>Musobaqa</span>
                            <span>{{ certificate.competition.title|truncatewords:5 }}</span>
                        </li>
                        <li>
                            <span>O'rin</span>
                            <span>#{{ certificate.rank }}</span>
                        </li>
                        <li>
                            <span>Ball</span>
                            <span>{{ certificate.score|floatformat:0 }}</span>
                        </li>
                        <li>
                            <span>Berilgan sana</span>
                            <span>{{ certificate.issued_at|date:"d.m.Y" }}</span>
                        </li>
                    </ul>

                    <div class="vc-code-display">
                        <i class="bi bi-shield-lock-fill"></i>
                        {{ certificate.verification_code }}
                    </div>
                </div>
            </div>

            {% else %}
            <!-- NOT FOUND -->
            <div class="vc-not-found">
                <div class="vc-not-found-icon">‚ùå</div>
                <h3>Sertifikat topilmadi</h3>
                <p>Ushbu kod bilan sertifikat mavjud emas. Kodni tekshirib qayta urinib ko'ring.</p>
            </div>
            {% endif %}
        {% endif %}

    </div>
</div>
{% endblock %}