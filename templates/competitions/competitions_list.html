{% extends 'base.html' %}
{% load static %}

{% block title %}Musobaqalar | TestMakon{% endblock %}

{% block extra_css %}
<style>
    /* ========== HERO ========== */
    .comp-hero {
        background: var(--gradient-dark);
        padding: 3rem 0;
        position: relative;
        overflow: hidden;
    }

    .comp-hero::before {
        content: '';
        position: absolute;
        inset: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        pointer-events: none;
    }

    .comp-hero-grid {
        position: relative;
        z-index: 1;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 3rem;
        align-items: center;
    }

    .comp-hero-text h1 {
        font-size: 2.5rem;
        color: white;
        margin-bottom: 0.75rem;
        line-height: 1.2;
    }

    .comp-hero-text h1 span { color: var(--primary); }

    .comp-hero-text p {
        font-size: 1.05rem;
        color: var(--gray-400);
        margin-bottom: 1.75rem;
        line-height: 1.7;
    }

    .comp-hero-actions {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .hero-btn {
        padding: 0.85rem 1.75rem;
        border-radius: var(--radius-lg, 14px);
        font-size: 0.95rem;
        font-weight: 700;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s;
        text-decoration: none;
        border: none;
    }

    .hero-btn.primary {
        background: var(--gradient-primary);
        color: white;
        box-shadow: 0 6px 20px -4px rgba(139,197,64,0.4);
    }

    .hero-btn.primary:hover { transform: translateY(-2px); color: white; }

    .hero-btn.outline {
        background: transparent;
        color: white;
        border: 2px solid var(--gray-600, #4B5563);
    }

    .hero-btn.outline:hover { border-color: var(--primary); color: var(--primary); }

    /* Hero Stats */
    .hero-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }

    .hero-stat {
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: var(--radius-lg, 14px);
        padding: 1.35rem;
        text-align: center;
        transition: all 0.3s;
    }

    .hero-stat:hover { background: rgba(255,255,255,0.08); transform: translateY(-2px); }
    .hero-stat-icon { font-size: 1.75rem; margin-bottom: 0.5rem; }
    .hero-stat-val { font-size: 1.5rem; font-weight: 800; color: white; }
    .hero-stat-label { font-size: 0.82rem; color: var(--gray-400); }

    /* ========== CONTENT ========== */
    .comp-content { padding: 2.5rem 0 4rem; }

    /* ========== QUICK ACTIONS ========== */
    .quick-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-bottom: 2.5rem;
    }

    .quick-card {
        background: var(--white, #fff);
        border: 1px solid var(--gray-200, #E5E7EB);
        border-radius: var(--radius-lg, 14px);
        padding: 1.5rem;
        text-align: center;
        text-decoration: none;
        transition: all 0.3s ease;
        display: block;
    }

    .quick-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 30px -8px rgba(0,0,0,0.1);
        border-color: var(--primary);
    }

    .quick-icon {
        width: 52px;
        height: 52px;
        border-radius: var(--radius-lg, 14px);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 0.85rem;
        font-size: 1.4rem;
    }

    .quick-icon.red { background: #FEE2E2; color: #DC2626; }
    .quick-icon.blue { background: #DBEAFE; color: #2563EB; }
    .quick-icon.purple { background: #EDE9FE; color: #7C3AED; }
    .quick-icon.amber { background: #FEF3C7; color: #D97706; }

    .quick-card h4 { font-size: 0.95rem; font-weight: 700; color: var(--dark); margin: 0 0 0.2rem; }
    .quick-card p { font-size: 0.82rem; color: var(--gray-500); margin: 0; }

    /* ========== SECTION ========== */
    .comp-section { margin-bottom: 2.5rem; }

    .section-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.25rem;
    }

    .section-title {
        font-size: 1.35rem;
        font-weight: 800;
        color: var(--dark);
        display: flex;
        align-items: center;
        gap: 0.65rem;
        margin: 0;
    }

    .section-title i { color: var(--primary); }

    .section-link {
        font-size: 0.88rem;
        font-weight: 600;
        color: var(--primary);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.35rem;
    }

    .section-link:hover { color: var(--primary-dark, #5a8a1e); }

    /* ========== DAILY CHALLENGE ========== */
    .daily-card {
        background: linear-gradient(135deg, #8B5CF6 0%, #6D28D9 100%);
        border-radius: var(--radius-xl, 20px);
        padding: 2rem;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .daily-card::before {
        content: 'üìÖ';
        position: absolute;
        top: -20px;
        right: -20px;
        font-size: 8rem;
        opacity: 0.1;
        pointer-events: none;
    }

    .daily-inner {
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 2rem;
    }

    .daily-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(255,255,255,0.2);
        padding: 0.45rem 0.95rem;
        border-radius: 50px;
        font-size: 0.82rem;
        font-weight: 600;
        margin-bottom: 0.85rem;
    }

    .daily-left h3 { font-size: 1.35rem; font-weight: 800; color: white; margin: 0 0 0.4rem; }
    .daily-left p { font-size: 0.92rem; color: rgba(255,255,255,0.9); margin: 0 0 1.25rem; }

    .daily-nums { display: flex; gap: 2rem; }
    .daily-num strong { display: block; font-size: 1.35rem; font-weight: 800; }
    .daily-num span { font-size: 0.78rem; opacity: 0.85; }

    .daily-btn {
        padding: 0.8rem 1.75rem;
        border-radius: var(--radius, 10px);
        font-size: 0.92rem;
        font-weight: 700;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        transition: all 0.3s;
        flex-shrink: 0;
    }

    .daily-btn.start { background: white; color: #6D28D9; border: none; }
    .daily-btn.start:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); color: #6D28D9; }
    .daily-btn.done { background: rgba(255,255,255,0.25); color: white; cursor: default; }

    /* ========== FEATURED CARDS ========== */
    .featured-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.25rem;
    }

    .f-card {
        background: var(--white, #fff);
        border: 1px solid var(--gray-200, #E5E7EB);
        border-radius: var(--radius-xl, 20px);
        overflow: hidden;
        transition: all 0.3s ease;
        text-decoration: none;
        display: flex;
        flex-direction: column;
    }

    .f-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 16px 40px -10px rgba(0,0,0,0.12);
    }

    .f-card.highlight {
        border: 2px solid var(--primary);
        position: relative;
    }

    .f-card.highlight::after {
        content: 'üî• TRENDDA';
        position: absolute;
        top: 0.75rem;
        right: 0.75rem;
        background: var(--gradient-primary);
        color: white;
        font-size: 0.68rem;
        font-weight: 700;
        padding: 0.3rem 0.7rem;
        border-radius: 50px;
        z-index: 2;
    }

    .f-banner {
        height: 140px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3.5rem;
        position: relative;
    }

    .f-banner.daily { background: linear-gradient(135deg, #10B981, #059669); }
    .f-banner.weekly { background: linear-gradient(135deg, #3B82F6, #1D4ED8); }
    .f-banner.monthly { background: linear-gradient(135deg, #8B5CF6, #6D28D9); }
    .f-banner.special { background: linear-gradient(135deg, #F59E0B, #D97706); }
    .f-banner.olympiad { background: linear-gradient(135deg, #EF4444, #B91C1C); }
    .f-banner.tournament { background: linear-gradient(135deg, #06B6D4, #0891B2); }

    .f-banner img { width: 100%; height: 100%; object-fit: cover; }

    .f-type {
        position: absolute;
        bottom: 0.65rem;
        left: 0.65rem;
        padding: 0.3rem 0.7rem;
        border-radius: 50px;
        font-size: 0.72rem;
        font-weight: 700;
        text-transform: uppercase;
        background: rgba(0,0,0,0.5);
        color: white;
        backdrop-filter: blur(4px);
    }

    .f-entry {
        position: absolute;
        top: 0.65rem;
        right: 0.65rem;
        padding: 0.3rem 0.7rem;
        border-radius: 50px;
        font-size: 0.72rem;
        font-weight: 700;
    }

    .f-entry.free { background: #D1FAE5; color: #059669; }
    .f-entry.paid { background: #FEF3C7; color: #D97706; }
    .f-entry.premium_only { background: #EDE9FE; color: #7C3AED; }

    .f-body { padding: 1.35rem; flex: 1; display: flex; flex-direction: column; }

    .f-title {
        font-size: 1.05rem;
        font-weight: 700;
        color: var(--dark);
        margin: 0 0 0.4rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .f-desc {
        font-size: 0.88rem;
        color: var(--gray-500);
        margin: 0 0 1rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .f-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.85rem;
        margin-bottom: 1rem;
        font-size: 0.82rem;
        color: var(--gray-500);
    }

    .f-meta span { display: flex; align-items: center; gap: 0.3rem; }
    .f-meta i { color: var(--primary); font-size: 0.85rem; }

    .f-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding-top: 1rem;
        border-top: 1px solid var(--gray-100, #F3F4F6);
        margin-top: auto;
    }

    .f-prize { display: flex; align-items: center; gap: 0.5rem; }

    .f-prize-icon {
        width: 34px;
        height: 34px;
        background: #FEF3C7;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.95rem;
    }

    .f-prize-val { font-size: 0.95rem; font-weight: 700; color: var(--dark); }
    .f-prize-sub { font-size: 0.72rem; color: var(--gray-500); }

    .f-btn {
        padding: 0.55rem 1.15rem;
        background: var(--gradient-primary);
        color: white;
        border: none;
        border-radius: var(--radius, 10px);
        font-size: 0.85rem;
        font-weight: 700;
        transition: all 0.2s;
        text-decoration: none;
    }

    .f-btn:hover { box-shadow: 0 6px 16px -4px rgba(139,197,64,0.4); color: white; }

    /* ========== COMP LIST CARDS ========== */
    .comp-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.15rem;
    }

    .c-card {
        background: var(--white, #fff);
        border: 1px solid var(--gray-200, #E5E7EB);
        border-radius: var(--radius-lg, 14px);
        padding: 1.25rem;
        display: flex;
        gap: 1rem;
        text-decoration: none;
        transition: all 0.25s ease;
    }

    .c-card:hover {
        box-shadow: 0 8px 24px -6px rgba(0,0,0,0.08);
        border-color: var(--gray-300);
    }

    .c-icon {
        width: 52px;
        height: 52px;
        background: var(--gray-100, #F3F4F6);
        border-radius: var(--radius-lg, 14px);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem;
        flex-shrink: 0;
    }

    .c-info { flex: 1; min-width: 0; }

    .c-title {
        font-size: 0.95rem;
        font-weight: 700;
        color: var(--dark);
        margin: 0 0 0.35rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .c-meta {
        display: flex;
        gap: 0.85rem;
        font-size: 0.8rem;
        color: var(--gray-500);
        margin-bottom: 0.5rem;
    }

    .c-meta span { display: flex; align-items: center; gap: 0.25rem; }
    .c-meta i { color: var(--primary); font-size: 0.82rem; }

    .c-badge {
        display: inline-block;
        font-size: 0.72rem;
        font-weight: 600;
        padding: 0.22rem 0.6rem;
        border-radius: 50px;
    }

    .c-badge.active { background: #D1FAE5; color: #059669; }
    .c-badge.upcoming { background: #DBEAFE; color: #2563EB; }
    .c-badge.finished { background: var(--gray-100, #F3F4F6); color: var(--gray-500); }

    /* ========== BATTLE CARDS ========== */
    .battles-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.15rem;
    }

    .b-card {
        background: var(--white, #fff);
        border: 1px solid var(--gray-200, #E5E7EB);
        border-radius: var(--radius-lg, 14px);
        padding: 1.25rem;
        text-decoration: none;
        transition: all 0.25s ease;
        display: block;
    }

    .b-card:hover { box-shadow: 0 8px 24px -6px rgba(0,0,0,0.08); }

    .b-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
    }

    .b-subject { font-size: 0.82rem; color: var(--gray-500); font-weight: 600; }

    .b-badge {
        font-size: 0.72rem;
        font-weight: 600;
        padding: 0.22rem 0.6rem;
        border-radius: 50px;
    }

    .b-badge.pending { background: #FEF3C7; color: #D97706; }
    .b-badge.accepted { background: #DBEAFE; color: #2563EB; }
    .b-badge.in_progress { background: #D1FAE5; color: #059669; }

    .b-players {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        margin-bottom: 0.5rem;
    }

    .b-player { text-align: center; }

    .b-avatar {
        width: 44px;
        height: 44px;
        background: var(--gray-200, #E5E7EB);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--gray-500);
        margin: 0 auto 0.35rem;
        overflow: hidden;
    }

    .b-avatar img { width: 100%; height: 100%; object-fit: cover; }
    .b-name { font-size: 0.8rem; font-weight: 600; color: var(--dark); }
    .b-vs { font-size: 1.1rem; font-weight: 900; color: var(--gray-300); }

    /* ========== EMPTY ========== */
    .empty-box {
        text-align: center;
        padding: 3rem 2rem;
        background: var(--gray-50, #F9FAFB);
        border-radius: var(--radius-xl, 20px);
    }

    .empty-box-icon { font-size: 3rem; margin-bottom: 0.75rem; opacity: 0.5; }
    .empty-box h4 { font-size: 1.1rem; font-weight: 700; margin: 0 0 0.4rem; }
    .empty-box p { font-size: 0.9rem; color: var(--gray-500); margin: 0; }

    /* ========== RESPONSIVE ========== */
    @media (max-width: 991px) {
        .comp-hero-grid { grid-template-columns: 1fr; text-align: center; }
        .comp-hero-actions { justify-content: center; }
        .hero-stats { max-width: 380px; margin: 1.5rem auto 0; }
        .featured-grid { grid-template-columns: 1fr; }
        .battles-grid { grid-template-columns: 1fr; }
        .quick-row { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
        .comp-hero { padding: 2rem 0; }
        .comp-hero-text h1 { font-size: 1.75rem; }
        .comp-grid { grid-template-columns: 1fr; }
        .daily-inner { flex-direction: column; text-align: center; }
        .daily-nums { justify-content: center; }
        .daily-btn { width: 100%; justify-content: center; }
    }

    @media (max-width: 575px) {
        .quick-row { gap: 0.75rem; }
        .quick-card { padding: 1.15rem; }
    }
</style>
{% endblock %}

{% block content %}
<!-- ========== HERO ========== -->
<div class="comp-hero">
    <div class="container">
        <div class="comp-hero-grid">
            <div class="comp-hero-text">
                <h1>üèÜ Musobaqalarda <span>g'olib</span> bo'ling!</h1>
                <p>Olimpiadalarda qatnashing, do'stlaringiz bilan bellashing va qimmatbaho sovrinlar yuting</p>
                <div class="comp-hero-actions">
                    <a href="#featured" class="hero-btn primary">
                        <i class="bi bi-trophy-fill"></i> Musobaqalar
                    </a>
                    {% if user.is_authenticated %}
                    <a href="{% url 'competitions:battle_create' %}" class="hero-btn outline">
                        <i class="bi bi-lightning-fill"></i> 1v1 Jang
                    </a>
                    {% else %}

                    <a href="{% url 'accounts:login' %}" class="hero-btn outline">
                        <i class="bi bi-box-arrow-in-right"></i> Kirish
                    </a>
                    {% endif %}
                </div>
            </div>

            <div class="hero-stats">
                {% if user_stats %}
                <div class="hero-stat">
                    <div class="hero-stat-icon">üèÜ</div>
                    <div class="hero-stat-val">{{ user_stats.competitions_won }}</div>
                    <div class="hero-stat-label">G'alabalar</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-icon">‚öîÔ∏è</div>
                    <div class="hero-stat-val">{{ user_stats.battles_won }}/{{ user_stats.battles_total }}</div>
                    <div class="hero-stat-label">Janglar</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-icon">üéØ</div>
                    <div class="hero-stat-val">{{ user_stats.competitions_joined }}</div>
                    <div class="hero-stat-label">Ishtiroklar</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-icon">‚ö°</div>
                    <div class="hero-stat-val">{{ user_stats.total_xp_earned }}</div>
                    <div class="hero-stat-label">Jami XP</div>
                </div>
                {% else %}
                <div class="hero-stat">
                    <div class="hero-stat-icon">üèÜ</div>
                    <div class="hero-stat-val">500K+</div>
                    <div class="hero-stat-label">Sovrinlar</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-icon">üë•</div>
                    <div class="hero-stat-val">10K+</div>
                    <div class="hero-stat-label">Qatnashchilar</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-icon">üìÖ</div>
                    <div class="hero-stat-val">50+</div>
                    <div class="hero-stat-label">Musobaqalar</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-icon">‚ö°</div>
                    <div class="hero-stat-val">24/7</div>
                    <div class="hero-stat-label">Janglar</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- ========== CONTENT ========== -->
<div class="comp-content">
    <div class="container">

        <!-- Quick Actions -->
        <div class="quick-row">
            <a href="{% if user.is_authenticated %}{% url 'competitions:battle_create' %}{% else %}{% url 'account_login' %}{% endif %}" class="quick-card">
                <div class="quick-icon red"><i class="bi bi-lightning-fill"></i></div>
                <h4>1v1 Jang</h4>
                <p>Do'st yoki bot bilan</p>
            </a>
            <a href="{% url 'competitions:weekly_league' %}" class="quick-card">
                <div class="quick-icon blue"><i class="bi bi-bar-chart-fill"></i></div>
                <h4>Haftalik Liga</h4>
                <p>Reytingda ko'taril</p>
            </a>
            <a href="{% url 'competitions:daily_challenge' %}" class="quick-card">
                <div class="quick-icon purple"><i class="bi bi-calendar-check-fill"></i></div>
                <h4>Kunlik Challenge</h4>
                <p>Har kuni yangi</p>
            </a>
            <a href="{% if user.is_authenticated %}{% url 'competitions:my_certificates' %}{% else %}{% url 'account_login' %}{% endif %}" class="quick-card">
                <div class="quick-icon amber"><i class="bi bi-award-fill"></i></div>
                <h4>Sertifikatlar</h4>
                <p>Yutuqlaringiz</p>
            </a>
        </div>

        <!-- ========== DAILY CHALLENGE ========== -->
        {% if daily_challenge %}
        <div class="comp-section">
            <div class="daily-card">
                <div class="daily-inner">
                    <div class="daily-left">
                        <div class="daily-badge">
                            <i class="bi bi-calendar-check-fill"></i> Bugungi challenge
                        </div>
                        <h3>{{ daily_challenge.subject.name|default:"Umumiy" }} ‚Äî {{ daily_challenge.question_count }} savol</h3>
                        <p>{{ daily_challenge.time_limit }} daqiqa ichida yeching va XP yuting</p>
                        <div class="daily-nums">
                            <div class="daily-num">
                                <strong>{{ daily_challenge.participants_count }}</strong>
                                <span>qatnashdi</span>
                            </div>
                            <div class="daily-num">
                                <strong>+{{ daily_challenge.xp_reward }}</strong>
                                <span>XP mukofot</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        {% if daily_completed %}
                        <span class="daily-btn done">
                            <i class="bi bi-check-circle-fill"></i> Yakunladingiz ‚úì
                        </span>
                        {% elif user.is_authenticated %}
                        <a href="{% url 'competitions:daily_challenge_start' %}" class="daily-btn start">
                            <i class="bi bi-play-fill"></i> Boshlash
                        </a>
                        {% else %}
                        <a href="{% url 'account_login' %}" class="daily-btn start">
                            <i class="bi bi-box-arrow-in-right"></i> Kirish
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- ========== FEATURED ========== -->
        {% if featured %}
        <div class="comp-section" id="featured">
            <div class="section-head">
                <h2 class="section-title">
                    <i class="bi bi-star-fill"></i> Tanlangan musobaqalar
                </h2>
            </div>

            <div class="featured-grid">
                {% for comp in featured %}
                <a href="{% url 'competitions:competition_detail' slug=comp.slug %}" class="f-card {% if forloop.first %}highlight{% endif %}">
                    <div class="f-banner {{ comp.competition_type }}">
                        {% if comp.banner %}
                        <img src="{{ comp.banner.url }}" alt="{{ comp.title }}">
                        {% else %}
                        {{ comp.icon }}
                        {% endif %}
                        <span class="f-type">{{ comp.get_competition_type_display }}</span>
                        <span class="f-entry {{ comp.entry_type }}">
                            {% if comp.entry_type == 'free' %}Bepul
                            {% elif comp.entry_type == 'paid' %}{{ comp.entry_fee|floatformat:0 }} so'm
                            {% else %}Premium
                            {% endif %}
                        </span>
                    </div>
                    <div class="f-body">
                        <h3 class="f-title">{{ comp.title }}</h3>
                        <p class="f-desc">{{ comp.short_description|default:comp.description|truncatewords:15 }}</p>
                        <div class="f-meta">
                            <span><i class="bi bi-people-fill"></i> {{ comp.participants_count }} qatnashchi</span>
                            <span><i class="bi bi-clock-fill"></i> {{ comp.duration_minutes }} daqiqa</span>
                            <span><i class="bi bi-journal-text"></i> {{ comp.total_questions }} savol</span>
                        </div>
                        <div class="f-footer">
                            {% if comp.prize_pool > 0 %}
                            <div class="f-prize">
                                <div class="f-prize-icon">üèÜ</div>
                                <div>
                                    <div class="f-prize-val">{{ comp.prize_pool|floatformat:0 }} so'm</div>
                                    <div class="f-prize-sub">Sovrin fondi</div>
                                </div>
                            </div>
                            {% else %}
                            <div class="f-prize">
                                <div class="f-prize-icon">‚ö°</div>
                                <div>
                                    <div class="f-prize-val">+{{ comp.xp_reward_first }} XP</div>
                                    <div class="f-prize-sub">1-o'rin uchun</div>
                                </div>
                            </div>
                            {% endif %}
                            <span class="f-btn">Batafsil ‚Üí</span>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- ========== ACTIVE ========== -->
        {% if active %}
        <div class="comp-section">
            <div class="section-head">
                <h2 class="section-title">
                    <i class="bi bi-play-circle-fill"></i> Hozir davom etmoqda
                </h2>
            </div>
            <div class="comp-grid">
                {% for comp in active %}
                <a href="{% url 'competitions:competition_detail' slug=comp.slug %}" class="c-card">
                    <div class="c-icon">{{ comp.icon }}</div>
                    <div class="c-info">
                        <h4 class="c-title">{{ comp.title }}</h4>
                        <div class="c-meta">
                            <span><i class="bi bi-people-fill"></i> {{ comp.participants_count }}</span>
                            <span><i class="bi bi-clock"></i> {{ comp.duration_minutes }} daq</span>
                        </div>
                        <span class="c-badge active">üü¢ Faol</span>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- ========== REGISTRATION OPEN ========== -->
        {% if registration_open %}
        <div class="comp-section">
            <div class="section-head">
                <h2 class="section-title">
                    <i class="bi bi-calendar-event-fill"></i> Ro'yxatga olish ochiq
                </h2>
            </div>
            <div class="comp-grid">
                {% for comp in registration_open %}
                <a href="{% url 'competitions:competition_detail' slug=comp.slug %}" class="c-card">
                    <div class="c-icon">{{ comp.icon }}</div>
                    <div class="c-info">
                        <h4 class="c-title">{{ comp.title }}</h4>
                        <div class="c-meta">
                            <span><i class="bi bi-people-fill"></i> {{ comp.participants_count }}</span>
                            <span><i class="bi bi-calendar3"></i> {{ comp.start_time|date:"d M, H:i" }}</span>
                        </div>
                        <span class="c-badge upcoming">üìÖ {{ comp.start_time|timeuntil }} qoldi</span>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- ========== USER BATTLES ========== -->
        {% if user_battles %}
        <div class="comp-section">
            <div class="section-head">
                <h2 class="section-title">
                    <i class="bi bi-lightning-fill"></i> Sizning janglaringiz
                </h2>
                <a href="{% url 'competitions:battles_list' %}" class="section-link">
                    Barchasi <i class="bi bi-arrow-right"></i>
                </a>
            </div>
            <div class="battles-grid">
                {% for battle in user_battles %}
                <a href="{% url 'competitions:battle_detail' uuid=battle.uuid %}" class="b-card">
                    <div class="b-header">
                        {% if battle.subject %}
                        <span class="b-subject">{{ battle.subject.name }}</span>
                        {% else %}
                        <span class="b-subject">üéØ Umumiy</span>
                        {% endif %}
                        <span class="b-badge {{ battle.status }}">
                            {% if battle.status == 'pending' %}‚è≥ Kutilmoqda
                            {% elif battle.status == 'accepted' %}‚úÖ Tayyor
                            {% elif battle.status == 'in_progress' %}üéÆ Davom etmoqda
                            {% endif %}
                        </span>
                    </div>
                    <div class="b-players">
                        <div class="b-player">
                            <div class="b-avatar">
                                {% if battle.challenger == request.user %}üë§{% else %}{{ battle.challenger.first_name|default:"?"|slice:":1" }}{% endif %}
                            </div>
                            <div class="b-name">
                                {% if battle.challenger == request.user %}Siz{% else %}{{ battle.challenger.first_name|default:"Noma'lum" }}{% endif %}
                            </div>
                        </div>
                        <div class="b-vs">VS</div>
                        <div class="b-player">
                            <div class="b-avatar">
                                {% if battle.opponent_type == 'bot' %}ü§ñ
                                {% elif battle.opponent %}{{ battle.opponent.first_name|default:"?"|slice:":1" }}
                                {% else %}‚ùì
                                {% endif %}
                            </div>
                            <div class="b-name">
                                {% if battle.opponent_type == 'bot' %}Bot ({{ battle.get_bot_difficulty_display }})
                                {% elif battle.opponent %}
                                    {% if battle.opponent == request.user %}Siz{% else %}{{ battle.opponent.first_name|default:"Noma'lum" }}{% endif %}
                                {% else %}Kutilmoqda
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- ========== FINISHED ========== -->
        {% if finished %}
        <div class="comp-section">
            <div class="section-head">
                <h2 class="section-title">
                    <i class="bi bi-check-circle-fill"></i> Yakunlangan musobaqalar
                </h2>
            </div>
            <div class="comp-grid">
                {% for comp in finished %}
                <a href="{% url 'competitions:competition_detail' slug=comp.slug %}" class="c-card">
                    <div class="c-icon">{{ comp.icon }}</div>
                    <div class="c-info">
                        <h4 class="c-title">{{ comp.title }}</h4>
                        <div class="c-meta">
                            <span><i class="bi bi-people-fill"></i> {{ comp.completed_count }} yakunladi</span>
                            <span><i class="bi bi-calendar3"></i> {{ comp.end_time|date:"d M" }}</span>
                        </div>
                        <span class="c-badge finished">‚úÖ Yakunlangan</span>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- ========== EMPTY ========== -->
        {% if not featured and not active and not registration_open and not daily_challenge %}
        <div class="empty-box">
            <div class="empty-box-icon">üèÜ</div>
            <h4>Hozircha musobaqalar yo'q</h4>
            <p>Tez orada yangi musobaqalar e'lon qilinadi. Hozircha 1v1 jang qilishingiz mumkin!</p>
            {% if user.is_authenticated %}
            <a href="{% url 'competitions:battle_create' %}" class="hero-btn primary" style="margin-top: 1.25rem;">
                <i class="bi bi-lightning-fill"></i> Jang boshlash
            </a>
            {% endif %}
        </div>
        {% endif %}

    </div>
</div>
{% endblock %}