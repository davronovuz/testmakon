{% extends 'base.html' %}

{% block title %}Zaif mavzular - TestMakon{% endblock %}

{% block content %}
<section class="section-sm" style="background: linear-gradient(135deg, #F8FAFC 0%, #E2E8F0 100%); min-height: calc(100vh - 200px);">
    <div class="container">
        <!-- Header -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3">
            <div>
                <h2 class="mb-1"><i class="bi bi-target text-primary me-2"></i> Zaif mavzular</h2>
                <p style="color: var(--gray-500);" class="mb-0">Bu mavzularda ko'proq mashq qilishingiz kerak</p>
            </div>
            <a href="{% url 'ai_core:test_analysis' %}" class="btn btn-light" style="border-radius: 12px;">
                <i class="bi bi-graph-up me-2"></i> Tahlilga qaytish
            </a>
        </div>

        <!-- Progress Overview -->
        <div class="card mb-4" style="border-radius: 20px;">
            <div class="card-body p-4">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h5 class="fw-bold mb-3">Yaxshilanish jarayoni</h5>
                        <div class="d-flex align-items-center gap-3">
                            <div class="flex-grow-1">
                                <div class="progress" style="height: 12px; border-radius: 6px;">
                                    <div class="progress-bar" style="width: {{ improvement_percent|default:35 }}%; background: var(--gradient-primary);"></div>
                                </div>
                            </div>
                            <span class="fw-bold text-gradient">{{ improvement_percent|default:35 }}%</span>
                        </div>
                        <p class="mt-2 mb-0" style="color: var(--gray-500);">{{ topics_improved|default:3 }} ta mavzuni yaxshiladingiz, {{ topics_remaining|default:5 }} ta qoldi</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <a href="{% url 'tests_app:practice_weak' %}" class="btn btn-primary" style="border-radius: 12px;">
                            <i class="bi bi-play-fill me-2"></i> Barchasini mashq qilish
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weak Topics by Subject -->
        {% for subject in subjects_with_weak_topics %}
        <div class="card mb-4" style="border-radius: 20px;">
            <div class="card-body p-4">
                <div class="d-flex align-items-center gap-3 mb-4">
                    <div style="font-size: 2rem;">{{ subject.icon }}</div>
                    <div>
                        <h5 class="fw-bold mb-0">{{ subject.name }}</h5>
                        <small style="color: var(--gray-500);">{{ subject.weak_count }} ta zaif mavzu</small>
                    </div>
                </div>

                <div class="row g-3">
                    {% for topic in subject.weak_topics %}
                    <div class="col-md-6">
                        <div class="p-4" style="background: {% if topic.score < 40 %}#FEE2E2{% elif topic.score < 60 %}#FEF3C7{% else %}var(--gray-50){% endif %}; border-radius: 16px; border-left: 4px solid {% if topic.score < 40 %}#EF4444{% elif topic.score < 60 %}#F59E0B{% else %}var(--gray-300){% endif %};">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="fw-bold mb-0" style="color: var(--dark);">{{ topic.name }}</h6>
                                <span class="badge {% if topic.score < 40 %}bg-danger{% elif topic.score < 60 %}bg-warning{% else %}bg-secondary{% endif %}">{{ topic.score }}%</span>
                            </div>
                            <p class="small mb-3" style="color: var(--gray-500);">{{ topic.wrong_count }} ta xato javob</p>
                            <div class="d-flex gap-2">
                                <a href="{% url 'tests_app:topic_test' subject.slug topic.slug %}" class="btn btn-sm btn-primary" style="border-radius: 8px;">
                                    <i class="bi bi-play-fill me-1"></i> Mashq
                                </a>
                                <a href="{% url 'ai_core:ai_tutor' %}?subject={{ subject.id }}&topic={{ topic.id }}" class="btn btn-sm btn-light" style="border-radius: 8px;">
                                    <i class="bi bi-book me-1"></i> O'rganish
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% empty %}
        <!-- Demo Data -->
        <div class="card mb-4" style="border-radius: 20px;">
            <div class="card-body p-4">
                <div class="d-flex align-items-center gap-3 mb-4">
                    <div style="font-size: 2rem;">âš¡</div>
                    <div>
                        <h5 class="fw-bold mb-0">Fizika</h5>
                        <small style="color: var(--gray-500);">3 ta zaif mavzu</small>
                    </div>
                </div>

                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="p-4" style="background: #FEE2E2; border-radius: 16px; border-left: 4px solid #EF4444;">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="fw-bold mb-0">Termodinamika</h6>
                                <span class="badge bg-danger">38%</span>
                            </div>
                            <p class="small mb-3" style="color: var(--gray-500);">12 ta xato javob</p>
                            <div class="d-flex gap-2">
                                <a href="#" class="btn btn-sm btn-primary" style="border-radius: 8px;"><i class="bi bi-play-fill me-1"></i> Mashq</a>
                                <a href="#" class="btn btn-sm btn-light" style="border-radius: 8px;"><i class="bi bi-book me-1"></i> O'rganish</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="p-4" style="background: #FEF3C7; border-radius: 16px; border-left: 4px solid #F59E0B;">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="fw-bold mb-0">Elektromagnetizm</h6>
                                <span class="badge bg-warning">52%</span>
                            </div>
                            <p class="small mb-3" style="color: var(--gray-500);">8 ta xato javob</p>
                            <div class="d-flex gap-2">
                                <a href="#" class="btn btn-sm btn-primary" style="border-radius: 8px;"><i class="bi bi-play-fill me-1"></i> Mashq</a>
                                <a href="#" class="btn btn-sm btn-light" style="border-radius: 8px;"><i class="bi bi-book me-1"></i> O'rganish</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4" style="border-radius: 20px;">
            <div class="card-body p-4">
                <div class="d-flex align-items-center gap-3 mb-4">
                    <div style="font-size: 2rem;">ðŸ§ª</div>
                    <div>
                        <h5 class="fw-bold mb-0">Kimyo</h5>
                        <small style="color: var(--gray-500);">2 ta zaif mavzu</small>
                    </div>
                </div>

                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="p-4" style="background: #FEE2E2; border-radius: 16px; border-left: 4px solid #EF4444;">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="fw-bold mb-0">Organik kimyo</h6>
                                <span class="badge bg-danger">42%</span>
                            </div>
                            <p class="small mb-3" style="color: var(--gray-500);">15 ta xato javob</p>
                            <div class="d-flex gap-2">
                                <a href="#" class="btn btn-sm btn-primary" style="border-radius: 8px;"><i class="bi bi-play-fill me-1"></i> Mashq</a>
                                <a href="#" class="btn btn-sm btn-light" style="border-radius: 8px;"><i class="bi bi-book me-1"></i> O'rganish</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

        <!-- Tips -->
        <div class="card" style="border-radius: 20px; background: var(--primary-glow);">
            <div class="card-body p-4">
                <div class="d-flex align-items-start gap-3">
                    <div class="icon-box-gradient">
                        <i class="bi bi-lightbulb"></i>
                    </div>
                    <div>
                        <h5 class="fw-bold mb-2">Maslahat</h5>
                        <p class="mb-0" style="color: var(--gray-600);">Har bir zaif mavzuni kuniga kamida 30 daqiqa mashq qiling. Avval eng past ballga ega mavzulardan boshlang. AI Tutor orqali tushunmagan joylaringizni so'rang.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}